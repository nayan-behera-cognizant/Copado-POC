<apex:page tabStyle="zqu__Quote__c" title="Amendment"
	standardController="zqu__Quote__c" extensions="zqu.ZQAmendmentController"
	sidebar="false" action="{!onLoad}" id="amendmentpage">
	<apex:includeScript value="{!$Resource.zqu__JQuery142}" />
<style>
.tertiaryPalette {
  background-color: #E7F3DD !important;
}

.apexp .bPageBlock.apexDefaultPageBlock .pbBody {
  margin-left: 0px; 
  margin-top: 0px;
  margin-right:0px;
} 

.bPageBlock .pbBody .pbSubheader {
  padding: 4px 3px 4px 8px !important;
}

.apexp .bPageBlock.apexDefaultPageBlock .pbBody .pbSubheader {
  border-top: 0 none;
  color: black;
}  

.bPageBlock .pbTitle {
  width: 45%; !important; 
} 

.customRenderedFieldPanel .requiredInput {
  float: left;
}
</style>   
	<script>
    var j$ = jQuery.noConflict();

    var prevProductIcon = null;
    var prevRatePlanIcon = null;

    function discountchange(planid, chargeid) {}

    function quantitychange(planid, chargeid) {}

    function effectivechange(planid, chargeid) {}

    function totalchange(planid, chargeid) {}

    function checkUnfinishedUnit(el) {
      var n = j$("div[id$=amendmentpage:amendmentForm:amendmentblock:subscriptionSection] input[type=button][value={!$Label.zqu__BUTTON_SAVE}]")
        .size();
      if (n > 0) {
        if (n == 1) alert("{!$Label.zqu__AMENDMENT_CHANGE_IS_NOT_SAVED}");
        else alert("{!$Label.zqu__AMENDMENT_CHANGES_ARE_NOT_SAVED}".replace('{0}', n));
        return false;
      } else return true;
    }

    function checkMultEditInTable(el) {
      var chargeTable = el.parentNode;
      while (chargeTable && chargeTable.tagName != 'TABLE') {
        chargeTable = chargeTable.parentNode;
      }
      var n = j$("table[id$=" + chargeTable.id + "] input[type=button][value={!$Label.zqu__BUTTON_SAVE}]")
        .size();
      if (n > 0) {
        alert("{!$Label.zqu__AMENDMENT_UNFINISHED_RATE_PLAN_CHANGE}");
        return false;
      } else return true;
    }

    function checkExpire(isExpired) {
      if (isExpired) {
        alert("{!$Label.zqu__AMENDMENT_RATE_PLAN_EXPIRED}");
        return true;
      } else {
        return false;
      }
    }

    function disableinput(el) {
      var querybuttons = "span[id$=" + el.parentNode.parentNode.id + "]";
      var newtable = j$(querybuttons)
        .prev();
      var inputfields = newtable.find("input");
      for (var i = 0; i < inputfields.size(); i++) {
        inputfields.eq(i)
          .attr("disabled", true);
      }
    }

    function disableAddUnitInput(el) {
      var querytr = "span[id$=" + el.parentNode.id + "]";
      var tr = j$(querytr)
        .parent()
        .parent();
      var inputfields = tr.find("input");
      for (var i = 0; i < inputfields.size(); i++) {
        inputfields.eq(i)
          .attr("disabled", true);
      }
    }

    function foldRatePlan() {
      j$('span[id$="panRatePlanSelector"]')
        .hide();
    }

    function foldQuoteCharge() {
      j$('span[id$="panQuoteChargeSelector"]')
        .hide();
    }

    // Redraw the radio button to uncheck if it was check already.
    function onProductSelect(radioIcon) {
      var radioIconId = radioIcon.id.replace(/:/g, "\\\:");
      if (null != prevProductIcon) {
        var prevRadioIcon = j$('#' + prevProductIcon.replace(/:/g, "\\\:"))
          .children();
        var prevRadioIconId = prevRadioIcon.attr('id');
        if (null != prevRadioIconId.match('imgRadioBtnChk')) {
          prevRadioIcon.replaceWith(j$('#' + radioIconId)
            .clone());
          // NOTE, the replaceWith will return the original object which could not be use for following steps.
          j$('#' + prevProductIcon.replace(/:/g, "\\\:"))
            .children()
            .attr('id', prevRadioIconId);
        }
      }
      prevProductIcon = j$('#' + radioIconId)
        .parent()
        .attr('id');

      var options = j$('span[id$="stsGetRatePlan"]');
      for (var i = 0; i < options.size(); i++) {
        if (radioIcon.parentNode.parentNode.parentNode.id != options.eq(i)
          .attr("id")) options.eq(i)
          .find('[onclick]')
          .removeAttr('onclick');
      }

      foldRatePlan();
      foldQuoteCharge();
    }

    function onRatePlanSelect(radioIcon) {
      var radioIconId = radioIcon.id.replace(/:/g, "\\\:");
      if (null != prevRatePlanIcon) {
        var prevRadioIcon = j$('#' + prevRatePlanIcon.replace(/:/g, "\\\:"))
          .children();
        var prevRadioIconId = prevRadioIcon.attr('id');
        if (null != prevRadioIconId.match('imgRadioBtnChk')) {
          prevRadioIcon.replaceWith(j$('#' + radioIconId)
            .clone());
          // NOTE, the replaceWith will return the original object which could not be use for following steps.
          j$('#' + prevRatePlanIcon.replace(/:/g, "\\\:"))
            .children()
            .attr('id', prevRadioIconId);
        }
      }
      prevRatePlanIcon = j$('#' + radioIconId)
        .parent()
        .attr('id');

      var options = j$('span[id$="stsGetQuoteCharge"]');
      for (var i = 0; i < options.size(); i++) {
        if (radioIcon.parentNode.parentNode.parentNode.id != options.eq(i)
          .attr("id")) options.eq(i)
          .find('[onclick]')
          .removeAttr('onclick');
      }

      foldQuoteCharge();
    }

    function disableInput4QuoteCharge() {
      j$('span[id$="panQuoteChargeSelector"] input[type$="text"]')
        .attr('disabled', true);
    }

    function disableAdd4QuoteCharge(type) {
      j$('span[id$="panQuoteChargeSelector"] [id$="btnAdd"]')
        .hide();
      if ("Saving" == type) {
        j$('span[id$="panQuoteChargeSelector"] [id$="btnCancel"]')
          .attr('value', '{!$Label.zqu__ACTION_STATUS_SAVING}');
      } else if ("Calculating" == type) {
        j$('span[id$="panQuoteChargeSelector"] [id$="btnCancel"]')
          .attr('value', '{!$Label.zqu__ACTION_STATUS_CALCULATING}');
      }
      j$('span[id$="panQuoteChargeSelector"] [id$="btnCancel"]')
        .attr('disabled', true);
    }

    function changePageSaveButtons(action) {
      var buttonName = "amendPageSaveButton";
      var buttons = j$('input[type="submit"][name*="amendPageSaveButton"]');
      changeSaveButton(buttons[0], action);
      changeSaveButton(buttons[1], action);
    }

    function changeSaveButton(saveBtn, action) {
      if (action == 'disable') {
        saveBtn.value = '{!$Label.zqu__ACTION_STATUS_UPDATING}';
        saveBtn.disable();
        saveBtn.className = 'btnDisabled';
      } else if (action == 'enable') {
        saveBtn.value = '{!$Label.zqu__BUTTON_SAVE}';
        saveBtn.enable();
        saveBtn.className = 'btn';
      }
    }

    function onChangeInvoiceOwner() {
      changePageSaveButtons('disable');
    }
  </script>
	<c:Notification />
	<apex:form >
		<apex:sectionHeader title="{!$Label.zqu__QUOTE_ENHANCEMENT_TITLE}" subtitle="{!subTitle}"
			id="amendmentTitle"
			rendered="{!(editAction && !isToHideDefaultProductSelector) || (isNewAmendmentQuote && isToHideDefaultProductSelector)}" />
		<apex:pageBlock title="{!subTitle}" id="amendmentblock"
			rendered="{!(!isToHideDefaultProductSelector || (isNewAmendmentQuote && isToHideDefaultProductSelector))}">
			<apex:pageBlockButtons location="both"
				rendered="{!(editAction && !isToHideDefaultProductSelector) || (isNewAmendmentQuote && isToHideDefaultProductSelector)}">
				<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE}"
					rendered="{!(editAction && !isToHideDefaultProductSelector)}"
					id="amendPageSaveButton" action="{!save}"
					onclick="if(!checkUnfinishedUnit()) return false;"
					disabled="{!!loadCompleted}" />
				<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}" immediate="true"
					rendered="{!(editAction && !isNewAmendmentQuote)}"
					action="{!cancel}"
					onclick="if(!checkUnfinishedUnit()) return false;"
					disabled="{!!loadCompleted}" />
				<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE}"
					rendered="{!(isNewAmendmentQuote && isToHideDefaultProductSelector)}"
					id="amendPageSaveButtonII" action="{!save}"
					onclick="if(!checkUnfinishedUnit()) return false;"
					disabled="{!!loadCompleted}" />
				<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}" immediate="true"
					rendered="{!isNewAmendmentQuote}" action="{!cancel}"
					onclick="if(!window.confirm('{!$Label.zqu__AMENDMENT_CANCELLED_COMFIRMATION}')) return false;"
					disabled="{!!loadCompleted}" />
			</apex:pageBlockButtons>
			<apex:dataList var="error" value="{!pageErrorMessages}"
				rendered="{!pageErrorMessages.size > 0 && (editAction || isNewAmendmentQuote)}">
				<apex:outputText value="{!error}"
					style="color:red;font-weight :bold" />
			</apex:dataList>
			<apex:outputPanel id="editBasicInfo"
				rendered="{!isNewAmendmentQuote}">
				<apex:actionRegion >
					<apex:pageBlockSection title="{!$Label.zqu__QUOTE_BASIC_INFORMATION}">
						<apex:outputField value="{!quote.zqu__Opportunity__c}" />
						<apex:outputField value="{!quote.Opportunity__r.Account.Name}" />
						<apex:inputField value="{!quote.Name}" required="true"
							style="width:300px" />
						<apex:inputField value="{!quote.zqu__BillToContact__c}" required="true"
							rendered="{!!isToHideBillToAndSoldToContacts}" />
						<apex:inputField value="{!quote.zqu__ValidUntil__c}" required="true" />
						<apex:inputField value="{!quote.zqu__SoldToContact__c}" required="true"
							rendered="{!!isToHideBillToAndSoldToContacts}" />
						<apex:outputField value="{!quote.zqu__Currency__c}" />
						<apex:pageBlockSectionItem rendered="{!invoiceOwnerSupport.isInvoiceOwnerEnabled}">
							<apex:outputPanel >
								<apex:outputLabel value="{!$Label.zqu__INVOICE_OWNER}" />
							</apex:outputPanel>
							<apex:outputPanel id="invoiceOwnerIdField">
								<apex:actionRegion >
									<c:LookupBrowse fieldId="InvoiceOwner"
										targetId="{!invoiceOwnerSupport.invoiceOwner}"
										targetName="{!invoiceOwnerSupport.invoiceOwnerName}"
										objectId="{!$CurrentPage.parameters.eid}"
										lookupType="CustomerAccount" editMode="true" />
									<script>
                    InvoiceOwner.addContextParameter('Currency', '{!JSENCODE(quote.zqu__Currency__c)}');
                    InvoiceOwner.addContextParameter('Status', 'Active');
                  </script>
									<apex:actionFunction name="changeInvoiceOwner"
										action="{!changeInvoiceOwner}"
										rerender="invoiceOwnerMessage,changeLogs"
										oncomplete="changePageSaveButtons('enable')" />
									<apex:actionFunction name="clearInvoiceOwner"
										action="{!clearInvoiceOwner}"
										oncomplete="changePageSaveButtons('enable')"
										rerender="invoiceOwnerMessage,changeLogs" />
								</apex:actionRegion>
								<div>
									<apex:outputPanel id="invoiceOwnerMessage">
										<apex:outputLabel rendered="{!invoiceOwnerSupport.hasError || invoiceOwnerSupport.hasWarning}"
											escape="false" value="{!invoiceOwnerSupport.warningMessage}"
											style="{!IF(invoiceOwnerSupport.hasError, 'color:#D74C3B', IF(invoiceOwnerSupport.hasWarning, 'color:#C85408', 'color:#000'))}"></apex:outputLabel>
									</apex:outputPanel>
								</div>
							</apex:outputPanel>
						</apex:pageBlockSectionItem>
						<apex:outputField value="{!quote.zqu__Subscription_Name__c}"
							rendered="{!AND(quote.zqu__Subscription_Name__c <> NULL, quote.zqu__Subscription_Name__c <> '')}" />
						<apex:outputField value="{!quote.zqu__SubscriptionVersion__c}" />
						<apex:inputField value="{!quote.Amendment_Name__c }"
							required="true" style="width:300px" />
						<apex:inputField value="{!quote.zqu__StartDate__c}" required="true">
							<apex:actionSupport event="onchange"
								action="{!onchangeQuoteStartDate}"
								reRender="editBasicInfo,enteringAddUnitStatus" />
						</apex:inputField>
						<apex:inputField value="{!quote.zqu__Description__c}"
							style="width:600px" />
					</apex:pageBlockSection>
				</apex:actionRegion>
			</apex:outputPanel>

			<apex:outputPanel id="standardProductSelectorSection"
				rendered="{!!isToHideDefaultProductSelector}">
				<apex:pageBlockSection columns="1"
					title="{!$Label.zqu__QUOTE_SUBSCRIPTION_PRODUCTS_AND_CHARGES}" id="subscriptionSection">
					<apex:outputPanel id="oldQuotePlanPanel">
						<apex:repeat var="quoteplan" value="{!oldQuotePlans}"
							id="oldQuotePlans_id">
							<apex:panelBar id="oldQuotePlanInfo">
								<apex:panelBarItem label="{!quoteplan.productName} : {!quoteplan.Name}"
									expanded="true"
									headerStyle="{!quoteplan.background}; {!quoteplan.contentstyle}"
									id="oldQuotePlanBar">
									<apex:actionRegion >
										<apex:pageBlockTable var="quoteCharge"
											value="{!quoteplan.quoteCharges}" rules="rows"
											cellpadding="4%" width="100%" id="oldQuotePlan">
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.Name.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.qcharge.Name}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ChargeType__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.qcharge.zqu__ChargeType__c}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Model__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.qcharge.zqu__Model__c}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListPrice__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.DisplayListPrice}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Discount__c.Label}</apex:facet>
												<apex:inputField value="{!quoteCharge.qcharge.zqu__Discount__c}"
													style="width:70%;font-weight:bold"
													rendered="{!quoteCharge.DiscountEditable && quoteCharge.EditMode}">
													<apex:actionSupport event="onchange"
														action="{!onolddiscountchange}"
														status="onProcessingStatus" reRender="oldQuotePlan">
														<apex:param name="focusQuotePlanId"
															assignTo="{!focusQuotePlanId}" value="{!quoteplan.Id}" />
														<apex:param name="changingChargeId"
															assignTo="{!changingChargeId}" value="{!quoteCharge.Id}" />
													</apex:actionSupport>
												</apex:inputField>
												<apex:outputText value="{!quoteCharge.DisplayDiscount}"
													rendered="{!quoteCharge.DiscountEditable && !quoteCharge.EditMode}"
													style="{!quoteplan.contentstyle}" />
												<apex:outputText value="%"
													rendered="{!quoteCharge.DiscountEditable}"
													style="{!quoteplan.contentstyle}" />
												<apex:outputText value="{!quoteCharge.DisplayDiscount}"
													rendered="{!!quoteCharge.DiscountEditable}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__EffectivePrice__c.Label}</apex:facet>
												<apex:inputField value="{!quoteCharge.qcharge.zqu__EffectivePrice__c}"
													style="width:80%;font-weight:bold"
													rendered="{!quoteCharge.EffectivePriceEditable && quoteCharge.EditMode}">
													<apex:actionSupport event="onchange"
														action="{!onOldEffectivePriceChange}"
														status="onProcessingStatus" reRender="oldQuotePlan">
														<apex:param name="focusQuotePlanId"
															assignTo="{!focusQuotePlanId}" value="{!quoteplan.Id}" />
														<apex:param name="changingChargeId"
															assignTo="{!changingChargeId}" value="{!quoteCharge.Id}" />
													</apex:actionSupport>
												</apex:inputField>
												<apex:outputText value="{!quoteCharge.DisplayEffectivePrice}"
													rendered="{!!quoteCharge.EditMode || !quoteCharge.EffectivePriceEditable }"
													style="{!quoteplan.contentstyle}" />
												<apex:outputText value="%"
													rendered="{!( quoteCharge.qcharge.zqu__Model__c == 'Discount-Percentage' )}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Quantity__c.Label}</apex:facet>
												<apex:inputField value="{!quoteCharge.qcharge.zqu__Quantity__c}"
													style="width:80%;font-weight:bold"
													rendered="{!quoteCharge.QuantityEditable && quoteCharge.EditMode}">
													<apex:actionSupport event="onchange"
														action="{!onOldQuantityChange}"
														status="onProcessingStatus" reRender="oldQuotePlan">
														<apex:param name="focusQuotePlanId"
															assignTo="{!focusQuotePlanId}" value="{!quoteplan.Id}" />
														<apex:param name="changingChargeId"
															assignTo="{!changingChargeId}" value="{!quoteCharge.Id}" />
													</apex:actionSupport>
												</apex:inputField>
												<apex:outputText value="{!quoteCharge.DisplayQuantity}"
													rendered="{!!quoteCharge.EditMode || !quoteCharge.QuantityEditable }"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__UOM__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.DisplayUOM}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Period__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.DisplayRecurringPeriod}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListTotal__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.DisplayListTotal}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%" style="{!quoteCharge.contentstyle}">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Total__c.Label}</apex:facet>
												<apex:inputField value="{!quoteCharge.qcharge.zqu__Total__c}"
													style="width:80%;font-weight:bold"
													rendered="{!quoteCharge.TotalEditable && quoteCharge.EditMode}">
													<apex:actionSupport event="onchange"
														action="{!onOldTotalChange}" status="onProcessingStatus"
														reRender="oldQuotePlan">
														<apex:param assignTo="{!focusQuotePlanId}"
															name="focusQuotePlanId" value="{!quoteplan.Id}" />
														<apex:param name="changingChargeId"
															assignTo="{!changingChargeId}" value="{!quoteCharge.Id}" />
													</apex:actionSupport>
												</apex:inputField>
												<apex:outputText value="{!quoteCharge.DisplayTotal}"
													rendered="{!!quoteCharge.EditMode || !quoteCharge.TotalEditable }"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="12%" style="{!quoteCharge.contentstyle}"
												rendered="{!editAction || isNewAmendmentQuote}">
												<apex:facet name="header">{!$Label.zqu__COLUMN_ACTIONS}</apex:facet>
												<apex:actionStatus id="enteringAddUnitStatus">
													<apex:facet name="start">
														<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_ADDING}" disabled="true" />
													</apex:facet>
													<apex:facet name="stop">
														<apex:commandButton value="{!$Label.zqu__BUTTON_ADD_UNITS}"
															disabled="{!quoteCharge.addUnitStatus!=1 && quoteplan.displayMode==1}"
															onclick="if(checkExpire({!quoteplan.isExpired})) return false;"
															status="enteringAddUnitStatus"
															rendered="{!quoteCharge.addUnitStatus== 0 && quoteplan.displayMode != 2 && editAction}"
															action="{!clickaddunit}"
															reRender="oldQuotePlan, oldQuotePlanButtons">
															<apex:param assignTo="{!focusQuotePlanId}"
																name="focusQuotePlanId" value="{!quoteplan.Id}" />
															<apex:param assignTo="{!changingChargeId}"
																name="changingChargeId" value="{!quoteCharge.Id}" />
														</apex:commandButton>
													</apex:facet>
												</apex:actionStatus>
												<apex:actionStatus id="onProcessingStatus"
													onstart="disableAddUnitInput(this);">
													<apex:facet name="start">
														<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE}" disabled="true" />
													</apex:facet>
													<apex:facet name="stop">
														<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE}"
															rendered="{!quoteCharge.addUnitStatus== 1 && quoteplan.displayMode == 1 && editAction}"
															action="{!onClickAddUnitSave}"
															status="onProcessingStatus"
															reRender="oldQuotePlan,oldQuotePlanButtons,changeLogs">
															<apex:param assignTo="{!focusQuotePlanId}"
																name="focusQuotePlanId" value="{!quoteplan.Id}" />
															<apex:param assignTo="{!changingChargeId}"
																name="changingChargeId" value="{!quoteCharge.Id}" />
														</apex:commandButton>
													</apex:facet>
												</apex:actionStatus>
												<apex:actionStatus id="addUnitPreSaveCancelingStatus">
													<apex:facet name="start">
														<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_CANCELING}" disabled="true" />
													</apex:facet>
													<apex:facet name="stop">
														<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}"
															status="addUnitPreSaveCancelingStatus"
															rendered="{!quoteCharge.addUnitStatus== 1 && quoteplan.displayMode == 1 && editAction}"
															immediate="false" action="{!onClickAddUnitPreSaveCancel}"
															reRender="oldQuotePlan,oldQuotePlanButtons">
															<apex:param assignTo="{!focusQuotePlanId}"
																name="focusQuotePlanId" value="{!quoteplan.Id}" />
															<apex:param assignTo="{!changingChargeId}"
																name="changingChargeId" value="{!quoteCharge.Id}" />
														</apex:commandButton>
													</apex:facet>
												</apex:actionStatus>
												<apex:actionStatus id="addUnitEditingStatus">
													<apex:facet name="start">
														<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_EDITING}" disabled="true" />
													</apex:facet>
													<apex:facet name="stop">
														<apex:commandButton value="{!$Label.zqu__BUTTON_EDIT}"
															status="addUnitEditingStatus"
															disabled="{!quoteCharge.addUnitStatus!=1 &&  quoteplan.displayMode==1}"
															rendered="{!quoteCharge.addUnitStatus== 2 && quoteplan.displayMode != 2 && editAction}"
															action="{!onClickAddUnitEdit}"
															reRender="oldQuotePlan,oldQuotePlanButtons">
															<apex:param assignTo="{!focusQuotePlanId}"
																name="focusQuotePlanId" value="{!quoteplan.Id}" />
															<apex:param assignTo="{!changingChargeId}"
																name="changingChargeId" value="{!quoteCharge.Id}" />
														</apex:commandButton>
													</apex:facet>
												</apex:actionStatus>
												<apex:actionStatus id="addUnitPostSaveCancelingStatus">
													<apex:facet name="start">
														<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_CANCELING}" disabled="true" />
													</apex:facet>
													<apex:facet name="stop">
														<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}"
															status="addUnitPostSaveCancelingStatus"
															disabled="{!quoteCharge.addUnitStatus!=1 &&  quoteplan.displayMode==1}"
															rendered="{!quoteCharge.addUnitStatus== 2 && quoteplan.displayMode != 2 && editAction}"
															action="{!onClickAddUnitPostSaveCancel}"
															reRender="oldQuotePlan,oldQuotePlanButtons,changeLogs">
															<apex:param assignTo="{!focusQuotePlanId}"
																name="focusQuotePlanId" value="{!quoteplan.Id}" />
															<apex:param assignTo="{!changingChargeId}"
																name="changingChargeId" value="{!quoteCharge.Id}" />
														</apex:commandButton>
													</apex:facet>
												</apex:actionStatus>
											</apex:column>
										</apex:pageBlockTable>
										<apex:outputPanel id="oldQuotePlanButtons"
											rendered="{!editAction}">
											<apex:commandButton value="{!$Label.zqu__BUTTON_DELETE}"
												style="position:relative;left:45%"
												action="{!deleteOldQuotePlan}"
												rendered="{!quoteplan.displayMode == 0 }"
												reRender="oldQuotePlanInfo,changeLogs">
												<apex:param assignTo="{!focusQuotePlanId}"
													name="focusQuotePlanId" value="{!quoteplan.Id}" />
											</apex:commandButton>
											<apex:commandButton value="{!$Label.zqu__BUTTON_UNDELETE}"
												style="position:relative;left:45%"
												action="{!undeleteOldQuotePlan}"
												rendered="{!quoteplan.displayMode == 2}"
												reRender="oldQuotePlanInfo,changeLogs">
												<apex:param assignTo="{!focusQuotePlanId}"
													name="focusQuotePlanId" value="{!quoteplan.Id}" />
											</apex:commandButton>
										</apex:outputPanel>
									</apex:actionRegion>
								</apex:panelBarItem>
							</apex:panelBar>
						</apex:repeat>
					</apex:outputPanel>
					<apex:outputPanel id="newQuotePlansRepeat">
						<apex:repeat var="quoteplan" value="{!newQuotePlans}">
							<apex:panelBar id="quoteplaninfo">
								<apex:panelBarItem label="{!quoteplan.productName} : {!quoteplan.Name}"
									expanded="true"
									headerStyle="{!quoteplan.background};{!quoteplan.contentstyle}"
									id="newquoteplanbar">
									<apex:actionRegion >
										<apex:pageBlockTable var="quoteCharge"
											value="{!quoteplan.quoteCharges}" rules="rows"
											cellpadding="4%" width="100%" id="newquoteplan">
											<apex:column width="15%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.Name.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.zcharge.Name}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ChargeType__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.zcharge.zqu__Type__c}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="10%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Model__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.zcharge.zqu__Model__c}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListPrice__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.DisplayListPrice}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Discount__c.Label}</apex:facet>
												<apex:inputField value="{!quoteCharge.qcharge.zqu__Discount__c}"
													style="width:70%"
													rendered="{!quoteCharge.DiscountEditable && quoteCharge.EditMode}">
													<apex:actionSupport event="onchange"
														action="{!onaddeddiscountchange}"
														status="changechargestatus1" reRender="newquoteplan">
														<apex:param name="focusQuotePlanId"
															assignTo="{!focusQuotePlanId}" value="{!quoteplan.Id}" />
														<apex:param name="changingChargeId"
															assignTo="{!changingChargeId}" value="{!quoteCharge.id}" />
													</apex:actionSupport>
												</apex:inputField>
												<apex:outputText value="{!quoteCharge.DisplayDiscount}"
													style="{!quoteplan.contentstyle}"
													rendered="{!quoteCharge.DiscountEditable && !quoteCharge.EditMode}"
													style="{!quoteplan.contentstyle}" />
												<apex:outputText value="%"
													rendered="{!quoteCharge.DiscountEditable}" />
												<apex:outputText value="{!quoteCharge.DisplayDiscount}"
													rendered="{!!quoteCharge.DiscountEditable}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__EffectivePrice__c.Label}</apex:facet>
												<apex:inputField value="{!quoteCharge.qcharge.zqu__EffectivePrice__c}"
													style="width:80%"
													rendered="{!quoteCharge.EffectivePriceEditable && quoteCharge.EditMode}">
													<apex:actionSupport event="onchange"
														action="{!onaddedepricechange}"
														status="changechargestatus1" reRender="newquoteplan">
														<apex:param name="focusQuotePlanId"
															assignTo="{!focusQuotePlanId}" value="{!quoteplan.Id}" />
														<apex:param name="changingChargeId"
															assignTo="{!changingChargeId}" value="{!quoteCharge.id}" />
													</apex:actionSupport>
												</apex:inputField>
												<apex:outputText value="{!quoteCharge.DisplayEffectivePrice}"
													rendered="{!!quoteCharge.EditMode || !quoteCharge.EffectivePriceEditable }"
													style="{!quoteplan.contentstyle}" />
												<apex:outputText value="%"
													rendered="{!( quoteCharge.qcharge.zqu__Model__c == 'Discount-Percentage' )}" />
											</apex:column>
											<apex:column width="8%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Quantity__c.Label}</apex:facet>
												<apex:inputField value="{!quoteCharge.qcharge.zqu__Quantity__c}"
													style="width:80%"
													rendered="{!quoteCharge.QuantityEditable && quoteCharge.EditMode}">
													<apex:actionSupport event="onchange"
														action="{!onaddedquantitychange}"
														status="changechargestatus1" reRender="newquoteplan">
														<apex:param name="focusQuotePlanId"
															assignTo="{!focusQuotePlanId}" value="{!quoteplan.Id}" />
														<apex:param name="changingChargeId"
															assignTo="{!changingChargeId}" value="{!quoteCharge.id}" />
													</apex:actionSupport>
												</apex:inputField>
												<apex:outputText value="{!quoteCharge.DisplayQuantity}"
													rendered="{!!quoteCharge.EditMode || !quoteCharge.QuantityEditable }"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__UOM__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.DisplayUOM}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="8%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Period__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.DisplayRecurringPeriod}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="9%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListTotal__c.Label}</apex:facet>
												<apex:outputText value="{!quoteCharge.DisplayListTotal}"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
											<apex:column width="10%">
												<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Total__c.Label}</apex:facet>
												<apex:inputField value="{!quoteCharge.qcharge.zqu__Total__c}"
													style="width:80%"
													rendered="{!quoteCharge.TotalEditable && quoteCharge.EditMode}">
													<apex:actionSupport event="onchange"
														action="{!onaddedtotalchange}"
														status="changechargestatus1" reRender="newquoteplan">
														<apex:param assignTo="{!focusQuotePlanId}"
															name="focusQuotePlanId" value="{!quoteplan.Id}" />
														<apex:param name="changingChargeId"
															assignTo="{!changingChargeId}" value="{!quoteCharge.id}" />
													</apex:actionSupport>
												</apex:inputField>
												<apex:outputText value="{!quoteCharge.DisplayTotal}"
													rendered="{!!quoteCharge.EditMode || !quoteCharge.TotalEditable }"
													style="{!quoteplan.contentstyle}" />
											</apex:column>
										</apex:pageBlockTable>
										<apex:outputPanel id="newquoteplanbuttons"
											rendered="{!editAction}">
											<apex:commandButton value="{!$Label.zqu__BUTTON_EDIT}"
												style="position:relative;left:40%"
												action="{!editnewquoteplan}"
												rendered="{!quoteplan.displayMode == 0 }"
												reRender="newquoteplan,newquoteplanbuttons">
												<apex:param assignTo="{!focusQuotePlanId}"
													name="focusQuotePlanId" value="{!quoteplan.Id}" />
											</apex:commandButton>
											<apex:commandButton value="{!$Label.zqu__BUTTON_DELETE}"
												style="position:relative;left:40%"
												onclick="if(!window.confirm('Are you sure you wish to remove this newly added product from the quote?')) return false;"
												action="{!deleteNewQuotePlan}"
												rendered="{!quoteplan.displayMode == 0 && editAction}"
												reRender="newQuotePlansRepeat,changeLogs">
												<apex:param assignTo="{!focusQuotePlanId}"
													name="focusQuotePlanId" value="{!quoteplan.Id}" />
											</apex:commandButton>
											<apex:actionStatus id="changechargestatus1"
												onstart="disableinput(this);">
												<apex:facet name="start">
													<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_CALCULATING}" disabled="true"
														style="position:relative;left:40%" />
												</apex:facet>
												<apex:facet name="stop">
													<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE}"
														status="changechargestatus1"
														style="position:relative;left:40%"
														action="{!savenewquoteplan}"
														rendered="{!quoteplan.displayMode == 1}"
														reRender="newquoteplan,newquoteplanbuttons,changeLogs">
														<apex:param assignTo="{!focusQuotePlanId}"
															name="focusQuotePlanId" value="{!quoteplan.Id}" />
													</apex:commandButton>
												</apex:facet>
											</apex:actionStatus>
											<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}"
												style="position:relative;left:40%"
												action="{!cancelnewquoteplan}"
												rendered="{!quoteplan.displayMode == 1}"
												reRender="newquoteplan,newquoteplanbuttons">
												<apex:param assignTo="{!focusQuotePlanId}"
													name="focusQuotePlanId" value="{!quoteplan.Id}" />
											</apex:commandButton>
										</apex:outputPanel>
									</apex:actionRegion>
								</apex:panelBarItem>
							</apex:panelBar>
						</apex:repeat>
					</apex:outputPanel>
					<apex:outputPanel id="addProductsButtons"
						rendered="{!!isToHideDefaultProductSelector}">
						<apex:actionRegion >
							<apex:actionStatus id="addProductStatus">
								<apex:facet name="start">
									<apex:commandButton value="{!$Label.zqu__PRODUCT_GETTING_PRODUCT_CATALOG}"
										disabled="true" style="position:relative;left:40%" />
								</apex:facet>
								<apex:facet name="stop">
									<apex:commandButton value="{!$Label.zqu__PRODUCT_ADD_MORE_PRODUCTS}"
										style="position:relative;left:40%" action="{!refreshProducts}"
										status="addProductStatus" rendered="{!editAction}"
										reRender="panProductSelector,panRatePlanSelector,panQuoteChargeSelector,addProductsButtons">
										<apex:param assignTo="{!resetProducts}" value="true" />
										<apex:param assignTo="{!productSearchString}"
											name="productSearchString" value="" />
									</apex:commandButton>
								</apex:facet>
							</apex:actionStatus>
							<apex:commandButton value="{!$Label.zqu__PRODUCT_CANCEL_ADD_PRODUCT}"
								style="position:relative;left:40%" rendered="{!showproduct}"
								action="{!cancelAddCharges}"
								reRender="panProductSelector,panRatePlanSelector,panQuoteChargeSelector,addProductsButtons" />
						</apex:actionRegion>
					</apex:outputPanel>
				</apex:pageBlockSection>
				<apex:outputPanel id="panProductSelector">
					<apex:pageBlock title="{!SUBSTITUTE($Label.zqu__PRODUCT_SUMMARY_FILTERED_BY, '{0}', quote.zqu__Currency__c)}"
						rendered="{!showProduct}">
						<apex:pageMessage rendered="{!isProductSearchError}"
							summary="{!productSearchError}" severity="error" strength="1" />
						<apex:pageBlockButtons style="text-align:right" location="top">
							<apex:actionRegion >
								<apex:inputText id="itProductSearch"
									value="{!productSearchString}" />
							</apex:actionRegion>
							<apex:actionStatus id="stsProductSearch">
								<apex:facet name="start">
									<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_SEARCHING}" disabled="true" />
								</apex:facet>
								<apex:facet name="stop">
									<apex:commandButton action="{!refreshProducts}" value="{!$Label.zqu__LOOKUP_BROWSE_SEARCH}"
										reRender="panProductSelector, panRatePlanSelector, panQuoteChargeSelector"
										status="stsProductSearch">
										<apex:param assignTo="{!resetProducts}" value="true" />
									</apex:commandButton>
								</apex:facet>
							</apex:actionStatus>
						</apex:pageBlockButtons>
						<apex:outputText rendered="{!products.size ==0}">{!$Label.zqu__PRODUCT_NO_PRODUCTS_FOUND}</apex:outputText>
						<apex:outputPanel rendered="{!products.size > 0}">
							<apex:pageBlockSection columns="1" showHeader="false">
								<apex:pageBlockTable id="tblProduct" title="products"
									var="product" value="{!products}" columns="4" cellpadding="3%"
									cellspacing="3%" style="width:100%" styleClass="list">
									<apex:column width="3%">
										<apex:facet name="header"></apex:facet>
										<apex:actionStatus id="stsGetRatePlan">
											<apex:facet name="start">
												<apex:outputPanel id="panProductSelectStart">
													<apex:image url="{!$Resource.zqu__ajaxLoading}" width="18"
														height="18" />
												</apex:outputPanel>
											</apex:facet>
											<apex:facet name="stop">
												<apex:outputPanel id="panProductSelectComplete">
													<apex:image id="imgRadioBtnChk"
														rendered="{!product.id == selProductId}"
														url="{!$Resource.zqu__radioBtnChk}" width="18" height="18" />
													<apex:image id="imgRadioBtnUnchk"
														rendered="{!NOT(product.id == selProductId)}"
														url="{!$Resource.zqu__radioBtnUnChk}" width="18" height="18"
														onclick="{onProductSelect(this);}" />
													<apex:actionSupport status="stsGetRatePlan" event="onclick"
														reRender="panProductSelector, panRatePlanSelector, panQuoteChargeSelector"
														action="{!refreshRateplans}">
														<apex:param assignTo="{!selProductId}" name="selProduct"
															value="{!product.id}" />
														<apex:param assignTo="{!resetRatePlans}"
															name="resetRatePlans" value="true" />
														<apex:param assignTo="{!ratePlanSearchString}"
															name="ratePlanSearchString" value="" />
													</apex:actionSupport>
												</apex:outputPanel>
											</apex:facet>
										</apex:actionStatus>
									</apex:column>
									<apex:column width="30%">
										<apex:facet name="header">{!$ObjectType.zqu__ZProduct__c.fields.Name.Label}</apex:facet>
										<apex:outputText value="{!product.Name}" />
									</apex:column>
									<apex:column width="15%">
										<apex:facet name="header">{!$ObjectType.zqu__ZProduct__c.fields.zqu__SKU__c.Label}</apex:facet>
										<apex:outputText value="{!product.zqu__SKU__c}" />
									</apex:column>
									<apex:column width="57%">
										<apex:facet name="header">{!$ObjectType.zqu__ZProduct__c.fields.zqu__Description__c.Label}</apex:facet>
										<apex:outputText value="{!product.zqu__Description__c}" />
									</apex:column>
								</apex:pageBlockTable>
							</apex:pageBlockSection>
						</apex:outputPanel>
						<table width="100%" style="text-align: right">
							<tbody>
								<tr>
									<td>
										<table style="text-align: left">
											<tbody>
												<tr>
													<td>
														<div>
															<apex:outputLabel rendered="{!products.size !=0}"
																id="lblProductSectionInfo" value="{!productSectionInfo}" />
														</div>
													</td>
												</tr>
											</tbody>
										</table>
									</td>
									<td colspan="6">
										<div>
											<span> <apex:commandLink action="{!prevProductPage}"
													rendered="{!AND(productHasPrevious, NOT(productNavFlagDisabled))}"
													reRender="panProductSelector,panRatePlanSelector,panQuoteChargeSelector"
													onclick="{foldRatePlan();foldQuoteCharge();}">
													<apex:image value="{!$Resource.zqu__back_enabled}" />
													</apex:commandlink>
													<apex:image value="{!$Resource.zqu__back_disabled}"
														rendered="{!OR(NOT(productHasPrevious), productNavFlagDisabled)}" /></span>
											<span> <apex:commandLink action="{!nextProductPage}"
													rendered="{!AND(productHasNext, NOT(productNavFlagDisabled))}"
													reRender="panProductSelector,panRatePlanSelector,panQuoteChargeSelector"
													onclick="{foldRatePlan();foldQuoteCharge();}">
													<apex:image value="{!$Resource.zqu__forward_enabled}" />
													</apex:commandlink>
													<apex:image value="{!$Resource.zqu__forward_disabled}"
														rendered="{!OR(NOT(productHasNext), productNavFlagDisabled)}" /></span>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</apex:pageBlock>
				</apex:outputPanel>
				<apex:outputPanel id="panRatePlanSelector">
					<apex:pageBlock title="{!$Label.zqu__RATE_PLAN_SUMMARY}" rendered="{!showRatePlan}">
						<apex:pageMessage rendered="{!isRatePlanSearchError}"
							summary="{!ratePlanSearchError}" severity="error" strength="1" />
						<apex:pageBlockButtons style="text-align:right" location="top">
							<apex:actionRegion >
								<apex:inputText id="ratePlanSearch" styleclass="tableitem"
									style="left:80%" value="{!ratePlanSearchString}" />
							</apex:actionRegion>
							<apex:actionStatus id="ratePlanSearchStatus">
								<apex:facet name="start">
									<apex:commandButton styleclass="tableitem" style="left:60%"
										value="{!$Label.zqu__ACTION_STATUS_SEARCHING}" disabled="true"></apex:commandButton>
								</apex:facet>
								<apex:facet name="stop">
									<apex:commandButton action="{!refreshRateplans}"
										styleclass="tableitem" style="left:60%" value="{!$Label.zqu__LOOKUP_BROWSE_SEARCH}"
										reRender="panRatePlanSelector, panQuoteChargeSelector"
										status="ratePlanSearchStatus">
										<apex:param assignTo="{!resetRatePlans}" value="true" />
									</apex:commandButton>
								</apex:facet>
							</apex:actionStatus>
						</apex:pageBlockButtons>
						<apex:outputText rendered="{!rateplans.size ==0}">{!$Label.zqu__RATE_PLAN_NO_RATE_PLAN_FOUND}</apex:outputText>
						<apex:outputPanel rendered="{!rateplans.size > 0}">
							<apex:pageBlockSection columns="1" showHeader="false">
								<apex:pageBlockTable id="tblRatePlan" title="ratePlans"
									var="ratePlan" value="{!ratePlans}" columns="3"
									cellpadding="3%" cellspacing="3%" style="width:100%"
									styleClass="list">
									<apex:column width="3%">
										<apex:facet name="header"></apex:facet>
										<apex:actionStatus id="stsGetQuoteCharge">
											<apex:facet name="start">
												<apex:outputPanel id="ratePlanSelectStart">
													<apex:image url="{!$Resource.zqu__ajaxLoading}" width="18"
														height="18" />
												</apex:outputPanel>
											</apex:facet>
											<apex:facet name="stop">
												<apex:outputPanel id="ratePlanSelectComplete">
													<apex:image id="imgRadioBtnChk"
														rendered="{!ratePlan.id == selRatePlanId}"
														url="{!$Resource.zqu__radioBtnChk}" width="18" height="18" />
													<apex:image id="imgRadioBtnUnchk"
														rendered="{!NOT(ratePlan.id == selRatePlanId)}"
														url="{!$Resource.zqu__radioBtnUnChk}" width="18" height="18"
														onclick="{onRatePlanSelect(this);}" />
													<apex:actionSupport status="stsGetQuoteCharge"
														event="onclick"
														reRender="panRatePlanSelector, panQuoteChargeSelector"
														action="{!refreshQuoteCharges}">
														<apex:param assignTo="{!selRatePlanId}" name="selRatePlan"
															value="{!ratePlan.id}" />
														<apex:param assignTo="{!resetquoteCharges}"
															name="resetquoteCharges" value="true" />
													</apex:actionSupport>
												</apex:outputPanel>
											</apex:facet>
										</apex:actionStatus>
									</apex:column>
									<apex:column width="30%">
										<apex:facet name="header">{!$ObjectType.zqu__ProductRatePlan__c.fields.Name.Label}</apex:facet>
										<apex:outputLabel value="{!ratePlan.Name}" />
									</apex:column>
									<apex:column width="67%">
										<apex:facet name="header">{!$ObjectType.zqu__ProductRatePlan__c.fields.zqu__Description__c.Label}</apex:facet>
										<apex:outputText value="{!ratePlan.zqu__Description__c}" />
									</apex:column>
								</apex:pageBlockTable>
							</apex:pageBlockSection>
						</apex:outputPanel>
						<table width="100%" style="text-align: right">
							<tbody>
								<tr>
									<td>
										<table style="text-align: left">
											<tbody>
												<tr>
													<td>
														<div>
															<apex:outputLabel rendered="{!rateplans.size !=0}"
																value="{!ratePlanSectionInfo}"></apex:outputLabel>
														</div>
													</td>
												</tr>
											</tbody>
										</table>
									</td>
									<td colspan="6">
										<div>
											<span> <apex:commandLink action="{!prevRatePlanPage}"
													rendered="{!AND(ratePlanHasPrevious, NOT(ratePlanNavFlagDisabled))}"
													reRender="panRatePlanSelector,panQuoteChargeSelector"
													onclick="foldQuoteCharge()">
													<apex:image value="{!$Resource.zqu__back_enabled}" />
													</apex:commandlink>
													<apex:image value="{!$Resource.zqu__back_disabled}"
														rendered="{!OR(NOT(ratePlanHasPrevious), ratePlanNavFlagDisabled)}" /></span>
											<span> <apex:commandLink action="{!nextRatePlanPage}"
													rendered="{!AND(ratePlanHasNext, NOT(ratePlanNavFlagDisabled))}"
													reRender="panRatePlanSelector,panQuoteChargeSelector"
													onclick="foldQuoteCharge()">
													<apex:image value="{!$Resource.zqu__forward_enabled}" />
													</apex:commandlink>
													<apex:image value="{!$Resource.zqu__forward_disabled}"
														rendered="{!OR(NOT(ratePlanHasNext), ratePlanNavFlagDisabled)}" /></span>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</apex:pageBlock>
				</apex:outputPanel>
				<apex:outputPanel id="panQuoteChargeSelector">
					<apex:pageBlock title="{!$Label.zqu__RATE_PLAN_CHARGE_SUMMARY}"
						rendered="{!showquoteCharge}">
						<apex:pageMessage rendered="{!isQuoteChargeError}"
							summary="{!quoteChargeError}" severity="error" strength="1" />
						<apex:pageBlockButtons location="bottom">
							<table width="100%" style="text-align: left">
								<tbody>
									<tr>
										<td><span> <apex:commandButton id="btnAdd"
													value="{!$Label.zqu__BUTTON_ADD}"
													onclick="disableInput4QuoteCharge(); disableAdd4QuoteCharge('Saving');"
													action="{!addcharges}"
													reRender="subscriptionSection, panProductSelector, panRatePlanSelector, panQuoteChargeSelector, changeLogs" />
										</span> <span> <apex:commandButton id="btnCancel"
													value="{!$Label.zqu__BUTTON_CANCEL}" action="{!cancelAddCharges}"
													reRender="addProductsButtons, panProductSelector, panRatePlanSelector, panQuoteChargeSelector" />
										</span></td>
										<td colspan="2"></td>
									</tr>
								</tbody>
							</table>
							<apex:actionStatus id="changeAddingChargeStatus"
								onstart="disableInput4QuoteCharge();disableAdd4QuoteCharge('Calculating');"></apex:actionStatus>
						</apex:pageBlockButtons>
						<apex:pageBlockTable var="quoteCharge" value="{!quoteCharges}"
							rules="rows" columns="11" cellpadding="3%" id="tblAddCharges"
							style="width:100%" styleClass="list" cellspacing="3%">
							<apex:column width="15%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.Name.Label}</apex:facet>
								<apex:outputText value="{!quoteCharge.qcharge.Name}" />
							</apex:column>
							<apex:column width="8%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ChargeType__c.Label}</apex:facet>
								<apex:outputText value="{!quoteCharge.qcharge.zqu__ChargeType__c}" />
							</apex:column>
							<apex:column width="10%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Model__c.Label}</apex:facet>
								<apex:outputText value="{!quoteCharge.qcharge.zqu__Model__c}" />
							</apex:column>
							<apex:column width="8%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListPrice__c.Label}</apex:facet>
								<apex:outputText value="{!quoteCharge.DisplayListPrice}" />
							</apex:column>
							<apex:column width="8%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Discount__c.Label}</apex:facet>
								<apex:inputField value="{!quoteCharge.qcharge.zqu__Discount__c}"
									style="width:70%;font-weight:bold"
									rendered="{!quoteCharge.DiscountEditable}">
									<apex:actionSupport action="{!onDiscountChange}"
										event="onchange" status="changeAddingChargeStatus"
										reRender="panQuoteChargeSelector">
										<apex:param name="changingchargeid"
											assignTo="{!changingchargeid}" value="{!quoteCharge.id}" />
									</apex:actionSupport>
								</apex:inputField>
								<apex:outputText value="{!quoteCharge.DisplayDiscount}"
									rendered="{!!quoteCharge.DiscountEditable}" />
								<apex:outputText value="%"
									rendered="{!quoteCharge.DiscountEditable}" />
							</apex:column>
							<apex:column width="8%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__EffectivePrice__c.Label}</apex:facet>
								<apex:inputField value="{!quoteCharge.qcharge.zqu__EffectivePrice__c}"
									style="width:80%;font-weight:bold"
									rendered="{!quoteCharge.EffectivePriceEditable}">
									<apex:actionSupport action="{!onEffectivePriceChange}"
										event="onchange" status="changeAddingChargeStatus"
										reRender="panQuoteChargeSelector">
										<apex:param name="changingchargeid"
											assignTo="{!changingchargeid}" value="{!quoteCharge.id}" />
									</apex:actionSupport>
								</apex:inputField>
								<apex:outputText value="{!quoteCharge.DisplayEffectivePrice}"
									rendered="{!!quoteCharge.EffectivePriceEditable }" />
								<apex:outputText value="%"
									rendered="{!IF( quoteCharge.qcharge.zqu__Model__c == 'Discount-Percentage', true, false)}" />
							</apex:column>
							<apex:column width="8%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Quantity__c.Label}</apex:facet>
								<apex:inputField value="{!quoteCharge.qcharge.zqu__Quantity__c}"
									style="width:80%;font-weight:bold"
									rendered="{!quoteCharge.QuantityEditable}">
									<apex:actionSupport action="{!onQuantityChange}"
										event="onchange" status="changeAddingChargeStatus"
										reRender="panQuoteChargeSelector">
										<apex:param name="changingchargeid"
											assignTo="{!changingchargeid}" value="{!quoteCharge.id}" />
									</apex:actionSupport>
								</apex:inputField>
								<apex:outputText value="{!quoteCharge.DisplayQuantity}"
									rendered="{!!quoteCharge.QuantityEditable }" />
							</apex:column>
							<apex:column width="8%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__UOM__c.Label}</apex:facet>
								<apex:outputText value="{!quoteCharge.DisplayUOM}" />
							</apex:column>
							<apex:column width="8%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Period__c.Label}</apex:facet>
								<apex:outputText value="{!quoteCharge.DisplayRecurringPeriod}" />
							</apex:column>
							<apex:column width="9%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListTotal__c.Label}</apex:facet>
								<apex:outputText value="{!quoteCharge.DisplayListTotal}" />
							</apex:column>
							<apex:column width="10%">
								<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Total__c.Label}</apex:facet>
								<apex:inputField value="{!quoteCharge.qcharge.zqu__Total__c}"
									style="width:80%;font-weight:bold"
									rendered="{!quoteCharge.TotalEditable}">
									<apex:actionSupport action="{!onTotalChange}" event="onchange"
										status="changeAddingChargeStatus"
										reRender="panQuoteChargeSelector">
										<apex:param name="changingchargeid"
											assignTo="{!changingchargeid}" value="{!quoteCharge.id}" />
									</apex:actionSupport>
								</apex:inputField>
								<apex:outputText value="{!quoteCharge.DisplayTotal}"
									rendered="{!NOT(quoteCharge.TotalEditable)}" />
							</apex:column>
						</apex:pageBlockTable>
					</apex:pageBlock>
				</apex:outputPanel>
				<apex:pageBlockSection title="{!$Label.zqu__CHANGES_VS_ORIGINAL}" id="changeLogs"
					columns="1">
					<apex:outputText value="{!$Label.zqu__CHANGES_NO_CHANGE_YET}"
						rendered="{!changeLogDetails.size == 0}" />
					<apex:pageBlockTable var="logDetail" value="{!changeLogDetails}"
						rules="rows" width="100%" columns="3" cellpadding="3%"
						rendered="{!changeLogDetails.size >0}">
						<apex:column width="80%">
							<apex:facet name="header">{!$Label.zqu__COLUMN_DESCRIPTION}</apex:facet>
							<apex:outputText value="{!logDetail.description}"
								style="font-weight:bold" />
						</apex:column>
						<apex:column width="10%">
							<apex:facet name="header">{!$Label.zqu__COLUMN_TOTAL_CHANGE}</apex:facet>
							<apex:outputText value="{!logDetail.changeTotalPrefix}"
								style="{!logDetail.changeTotalStyle}" />
							<apex:outputText value="{!logDetail.changeTotal}"
								style="{!logDetail.changeTotalStyle}" />
						</apex:column>
						<apex:column width="10%" rendered="{!editAction}">
							<apex:facet name="header">{!$Label.zqu__COLUMN_ACTIONS}</apex:facet>
							<apex:actionRegion >
								<apex:commandButton value="{!$Label.zqu__BUTTON_UNDO}" action="{!onClickUndo}"
									rendered="{!logDetail.logtype != 1 && logDetail.logType != 5}"
									reRender="changeLogs,oldQuotePlanPanel">
									<apex:param name="undoType" assignTo="{!undoType}"
										value="{!logDetail.logtype}" />
									<apex:param name="focusQuotePlanId"
										assignTo="{!focusQuotePlanId}"
										value="{!logDetail.quoteplanid}" />
									<apex:param name="changingChargeId"
										assignTo="{!changingChargeId}"
										value="{!logDetail.quotechargeid}" />
								</apex:commandButton>
								<apex:commandButton value="{!$Label.zqu__BUTTON_UNDO}" action="{!onClickUndo}"
									onclick="if(!window.confirm('{!$Label.zqu__PRODUCT_REMOVE_NEWLY_ADDED_PRODUCT}')) return false;"
									rendered="{!logDetail.logtype == 1}"
									reRender="changeLogs,newQuotePlansRepeat">
									<apex:param name="undoType" assignTo="{!undoType}"
										value="{!logDetail.logtype}" />
									<apex:param name="focusQuotePlanId"
										assignTo="{!focusQuotePlanId}"
										value="{!logDetail.quoteplanid}" />
									<apex:param name="changingChargeId"
										assignTo="{!changingChargeId}"
										value="{!logDetail.quotechargeid}" />
								</apex:commandButton>
							</apex:actionRegion>
						</apex:column>
					</apex:pageBlockTable>
				</apex:pageBlockSection>
			</apex:outputPanel>
		</apex:pageBlock>
	</apex:form>
	<apex:form >
		<apex:panelGrid columns="1" id="theGrid" width="100%"
			style="text-align:center"
			rendered="{!(editAction && !isNewAmendmentQuote && isToHideDefaultProductSelector)}">
			<apex:commandButton action="{!cancel}" value="{!$Label.zqu__BUTTON_BACK}" id="btnBack" />
		</apex:panelGrid>
	</apex:form>
	<c:AmendmentRatePlans id="customProductSelectorSection"
		newAmendmentQuoteFlag="{!isNewAmendmentQuote}"
		amendmentQuote="{!quote}"
		rendered="{!(!isNewAmendmentQuote && isToHideDefaultProductSelector)}" />
</apex:page>