<apex:page tabStyle="zqu__Quote__c" title="Renewal"
	standardController="zqu__Quote__c" extensions="zqu.ZQRenewalController"
	sidebar="false" action="{!onload}" id="renewalpage">
<style>
.tertiaryPalette {
  background-color: #E7F3DD !important;
}

.apexp .bPageBlock.apexDefaultPageBlock .pbBody {
  margin-left: 0px; 
  margin-top: 0px;
  margin-right:0px;
} 

.bPageBlock .pbBody .pbSubheader {
  padding: 4px 3px 4px 8px !important;
}

.apexp .bPageBlock.apexDefaultPageBlock .pbBody .pbSubheader {
  border-top: 0 none;
  color: black;
}  

.bPageBlock .pbTitle {
  width: 45%; !important; 
} 

.customRenderedFieldPanel .requiredInput {
  float: left;
}
</style>
	<apex:includeScript value="{!$Resource.zqu__JQuery142}" />
	<script>
		var j$ = jQuery.noConflict();

		var prevProductIcon = null;
		var prevRatePlanIcon = null;

		function discountchange(planid, chargeid) {
		}

		function quantitychange(planid, chargeid) {
		}

		function effectivechange(planid, chargeid) {
		}

		function totalchange(planid, chargeid) {
		}

		function checkUnfinishedUnit() {
			var n = j$(
					"div[id$=renewalpage:renewalForm:renewalblock:subscriptionsection] input[type=button][value=Save]")
					.size();
			var m = j$(
					"div[id$=renewalpage:renewalForm:renewalblock:subscriptionsection] input[type=button][value=Save All Changes]")
					.size();
			if (n > 0) {
				if (n == 1)
					alert("{!$Label.RENEWAL_CHANGE_IS_NOT_SAVED}");
				else
					alert("{!$Label.RENEWAL_CHANGES_ARE_NOT_SAVED}".replace('{0}', n));
				return false;
			} else if (m > 0) {
				alert("{!$Label.RENEWAL_AUTO_REPLACEMENT_PROCESS}");
			} else
				return true;
		}

		function disableinput(el) {
			var querybuttons = "span[id$=" + el.parentNode.parentNode.id + "]";
			var newtable = j$(querybuttons).prev();
			var inputfields = newtable.find("input");
			for ( var i = 0; i < inputfields.size(); i++) {
				inputfields.eq(i).attr("disabled", true);
			}
		}

		function saveallstatus(disabled) {
			var newquoteplanpanel = j$("span[id$=renewalpage:renewalForm:renewalblock:subscriptionsection:newquoteplanpanel]");
			var inputfields = newquoteplanpanel.find("input");
			for ( var i = 0; i < inputfields.size(); i++) {
				inputfields.eq(i).attr("disabled", disabled);
			}
		}

		function disableaddunitinput(el) {
			var querytr = "span[id$=" + el.parentNode.id + "]";
			var tr = j$(querytr).parent().parent();
			var inputfields = tr.find("input");
			for ( var i = 0; i < inputfields.size(); i++) {
				inputfields.eq(i).attr("disabled", true);
			}
		}

		function foldRatePlan() {
			j$('span[id$="panRatePlanSelector"]').hide();
		}

		function foldQuoteCharge() {
			j$('span[id$="panQuoteChargeSelector"]').hide();
		}

		// Redraw the radio button to uncheck if it was check already.               
		function onProductSelect(radioIcon) {
			var radioIconId = radioIcon.id.replace(/:/g, "\\\:");
			if (null != prevProductIcon) {
				var prevRadioIcon = j$(
						'#' + prevProductIcon.replace(/:/g, "\\\:")).children();
				var prevRadioIconId = prevRadioIcon.attr('id');
				if (null != prevRadioIconId.match('imgRadioBtnChk')) {
					prevRadioIcon.replaceWith(j$('#' + radioIconId).clone());
					// NOTE, the replaceWith will return the original object which could not be use for following steps.
					j$('#' + prevProductIcon.replace(/:/g, "\\\:")).children()
							.attr('id', prevRadioIconId);
				}
			}
			prevProductIcon = j$('#' + radioIconId).parent().attr('id');

			var options = j$('span[id$="stsGetRatePlan"]');
			for ( var i = 0; i < options.size(); i++) {
				if (radioIcon.parentNode.parentNode.parentNode.id != options
						.eq(i).attr("id"))
					options.eq(i).find('[onclick]').removeAttr('onclick');
			}

			foldRatePlan();
			foldQuoteCharge();
		}

		function onRatePlanSelect(radioIcon) {
			var radioIconId = radioIcon.id.replace(/:/g, "\\\:");
			if (null != prevRatePlanIcon) {
				var prevRadioIcon = j$(
						'#' + prevRatePlanIcon.replace(/:/g, "\\\:"))
						.children();
				var prevRadioIconId = prevRadioIcon.attr('id');
				if (null != prevRadioIconId.match('imgRadioBtnChk')) {
					prevRadioIcon.replaceWith(j$('#' + radioIconId).clone());
					// NOTE, the replaceWith will return the original object which could not be use for following steps.
					j$('#' + prevRatePlanIcon.replace(/:/g, "\\\:")).children()
							.attr('id', prevRadioIconId);
				}
			}
			prevRatePlanIcon = j$('#' + radioIconId).parent().attr('id');

			var options = j$('span[id$="stsGetQuoteCharge"]');
			for ( var i = 0; i < options.size(); i++) {
				if (radioIcon.parentNode.parentNode.parentNode.id != options
						.eq(i).attr("id"))
					options.eq(i).find('[onclick]').removeAttr('onclick');
			}

			foldQuoteCharge();
		}

		function disableInput4QuoteCharge() {
			j$('span[id$="panQuoteChargeSelector"] input[type$="text"]').attr(
					'disabled', true);
		}

		function disableAdd4QuoteCharge(type) {
			j$('span[id$="panQuoteChargeSelector"] [id$="btnAdd"]').hide();
			if ("Saving" == type) {
				j$('span[id$="panQuoteChargeSelector"] [id$="btnCancel"]')
						.attr('value', '{!$Label.ACTION_STATUS_SAVING}');
			} else if ("Calculating" == type) {
				j$('span[id$="panQuoteChargeSelector"] [id$="btnCancel"]')
						.attr('value', '{!$Label.zqu__ACTION_STATUS_CALCULATING}');
			}
			j$('span[id$="panQuoteChargeSelector"] [id$="btnCancel"]').attr(
					'disabled', true);
		}

		function changePageSaveButtons(action) {
			var buttonName = "renewalpage:renewalForm:renewalblock:pageButtonBar:pageSaveButton";
			var buttons = document.getElementsByName(buttonName);
			changeSaveButton(buttons[0], action);
			changeSaveButton(buttons[1], action);
		}

		function changeSaveButton(saveBtn, action) {
			if (action == 'disable') {
				saveBtn.value = '{!$Label.ACTION_STATUS_UPDATING}';
				saveBtn.disable();
				saveBtn.className = 'btnDisabled';
			} else if (action == 'enable') {
				saveBtn.value = '{!$Label.zqu__BUTTON_SAVE}';
				saveBtn.enable();
				saveBtn.className = 'btn';
			}
		}

		function onChangeInvoiceOwner() {
			changePageSaveButtons('disable');
		}
	</script>
	<apex:pageMessages />
	<apex:form id="renewalForm">
		<apex:sectionHeader title="{!$Label.zqu__QUOTE_ENHANCEMENT_TITLE}" subtitle="{!subTitle}"
			id="renewalTitle" rendered="{!editAction}" />
		<apex:pageBlock title="{!subTitle}" id="renewalblock">
			<apex:pageBlockButtons id="pageButtonBar">
				<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE}" id="pageSaveButton"
					rendered="{!editAction}" action="{!save}"
					onclick="if(!checkUnfinishedUnit()) return false;"
					disabled="{!!loadCompleted}" />
				<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}" immediate="true"
					rendered="{!editAction && !isNewAmendmentQuote}" action="{!cancel}"
					onclick="if(!checkUnfinishedUnit()) return false;"
					disabled="{!!loadCompleted}" />
				<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}" immediate="true"
					rendered="{!isNewAmendmentQuote}" action="{!cancel}"
					onclick="if(!window.confirm('{!$Label.zqu__RENEWAL_CANCELLED_COMFIRMATION}')) return false;"
					disabled="{!!loadCompleted}" />
			</apex:pageBlockButtons>
			<apex:dataList var="error" value="{!pageErrorMessages}"
				rendered="{!pageErrorMessages.size > 0 && (editAction || isNewAmendmentQuote)}">
				<apex:outputText value="{!error}"
					style="color:red;font-weight :bold" />
			</apex:dataList>
			<apex:outputPanel id="editbasicinfo"
				rendered="{!isNewAmendmentQuote}">
				<apex:actionRegion >
					<apex:pageBlockSection title="{!$Label.zqu__QUOTE_BASIC_INFORMATION}">
						<apex:outputField value="{!quote.zqu__Opportunity__c}" />
						<apex:outputField value="{!quote.Opportunity__r.Account.Name}" />
						<apex:inputField value="{!quote.Name}" required="true"
							style="width:300px" />
						<apex:inputField value="{!quote.zqu__BillToContact__c}" required="true"
							rendered="{!!isToHideBillToAndSoldToContacts}" />
						<apex:inputField value="{!quote.zqu__ValidUntil__c}" required="true" />
						<apex:inputField value="{!quote.zqu__SoldToContact__c}" required="true"
							rendered="{!!isToHideBillToAndSoldToContacts}" />
						<apex:outputField value="{!quote.zqu__Currency__c}" />
						<apex:pageBlockSectionItem rendered="{!invoiceOwnerSupport.isInvoiceOwnerEnabled}">
							<apex:outputPanel >
								<apex:outputLabel value="{!$Label.zqu__INVOICE_OWNER}" />
							</apex:outputPanel>
							<apex:outputPanel id="invoiceOwnerIdField">
								<apex:actionRegion >
									<c:LookupBrowse fieldId="InvoiceOwner"
										targetId="{!invoiceOwnerSupport.invoiceOwner}"
										targetName="{!invoiceOwnerSupport.invoiceOwnerName}"
										objectId="{!$CurrentPage.parameters.eid}"
										lookupType="CustomerAccount" editMode="true" />
									<script>
										InvoiceOwner
												.addContextParameter(
														'Currency',
														'{!JSENCODE(quote.Currency__c)}');
										InvoiceOwner.addContextParameter(
												'Status', 'Active');
									</script>
									<apex:actionFunction name="changeInvoiceOwner"
										status="onChangeStatus" action="{!changeInvoiceOwner}"
										rerender="invoiceOwnerMessage,changelogs"
										oncomplete="changePageSaveButtons('enable')" />
									<apex:actionFunction name="clearInvoiceOwner"
										status="onChangeStatus" action="{!clearInvoiceOwner}"
										rerender="invoiceOwnerMessage,changelogs"
										oncomplete="changePageSaveButtons('enable')" />
								</apex:actionRegion>
								<div>
									<apex:outputPanel id="invoiceOwnerMessage">
										<apex:outputLabel rendered="{!invoiceOwnerSupport.hasError || invoiceOwnerSupport.hasWarning}"
											escape="false" value="{!invoiceOwnerSupport.warningMessage}"
											style="{!IF(invoiceOwnerSupport.hasError, 'color:#D74C3B', IF(invoiceOwnerSupport.hasWarning, 'color:#C85408', 'color:#000'))}"></apex:outputLabel>
									</apex:outputPanel>
								</div>
							</apex:outputPanel>
						</apex:pageBlockSectionItem>
						<apex:outputField value="{!quote.zqu__Subscription_Name__c}"
							rendered="{!AND(quote.zqu__Subscription_Name__c <> NULL, quote.zqu__Subscription_Name__c <> '')}" />
						<apex:outputField value="{!quote.zqu__SubscriptionVersion__c}" />
						<apex:outputField value="{!quote.zqu__StartDate__c}" />
						<apex:inputField value="{!quote.zqu__RenewalTerm__c}" required="true">
							<apex:actionSupport event="onchange" immediate="false"
								action="{!onChangeRenewalTerm}" reRender="changelogs" />
						</apex:inputField>
						<apex:inputField value="{!quote.zqu__Description__c}"
							style="width:600px" />
					</apex:pageBlockSection>
				</apex:actionRegion>
			</apex:outputPanel>
			<apex:pageBlockSection columns="1"
				title="{!$Label.zqu__QUOTE_SUBSCRIPTION_PRODUCTS_AND_CHARGES}" id="subscriptionsection">
				<apex:outputPanel id="oldquoteplanpanel">
					<apex:repeat var="quoteplan" value="{!oldQuotePlans}"
						id="oldQuotePlans_id">
						<apex:panelBar id="oldquoteplaninfo">
							<apex:panelBarItem label="{!quoteplan.productName} : {!quoteplan.Name}"
								expanded="true"
								headerStyle="{!quoteplan.background};{!quoteplan.contentstyle}"
								id="oldquoteplanbar">
								<apex:actionRegion >
									<apex:outputPanel style="background-color:#F5F6CE;"
										layout="block"
										rendered="{!quoteplan.isExpired && quoteplan.displayMode == 0}">
										<apex:outputLabel style="color:red;font-weight:bold"
											value="{!$Label.zqu__RATE_PLAN_EXPIRED}"
											rendered="{!quoteplan.replacerateplans.size == 0 || (quoteplan.replacerateplans.size > 0 && (!editAction || autoreplacing))}"></apex:outputLabel>
										<apex:outputLabel style="color:red;font-weight:bold"
											value="{!$Label.zqu__RATE_PLAN_EXPIRED_CHOOSE_REPLACEMENT}"
											rendered="{!quoteplan.replacerateplans.size > 0 && editAction && !autoreplacing}"></apex:outputLabel>
										<apex:selectList id="replacerateplan"
											value="{!quoteplan.replacerateplanid}"
											rendered="{!quoteplan.replacerateplans.size > 0 && editAction && !autoreplacing}"
											size="1">
											<apex:selectOptions value="{!quoteplan.replacerateplans}"></apex:selectOptions>
										</apex:selectList>
										<apex:commandButton value="{!$Label.zqu__BUTTON_SELECT}" action="{!replacerateplan}"
											reRender="subscriptionsection,changelogs"
											rendered="{!quoteplan.replacerateplans.size > 0 && editAction && !autoreplacing}">
											<apex:param assignTo="{!focusquoteplanid}"
												name="focusquoteplanid" value="{!quoteplan.Id}" />
										</apex:commandButton>
									</apex:outputPanel>
									<apex:pageBlockTable var="quotecharge"
										value="{!quoteplan.quotecharges}" rules="rows"
										cellpadding="4%" width="100%" id="oldquoteplan">
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.Name.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.qcharge.Name}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ChargeType__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.qcharge.zqu__ChargeType__c}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Model__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.qcharge.zqu__Model__c}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListPrice__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.DisplayListPrice}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Discount__c.Label}</apex:facet>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Discount__c}"
												style="width:70%"
												rendered="{!quotecharge.DiscountEditable && quotecharge.EditMode}">
												<apex:actionSupport event="onchange"
													action="{!onolddiscountchange}" status="onchangeoldstatus"
													reRender="oldquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:outputText value="{!quotecharge.DisplayDiscount}"
												rendered="{!quotecharge.DiscountEditable && !quotecharge.EditMode}"
												style="{!quoteplan.contentstyle}" />
											<apex:outputText value="%"
												rendered="{!quotecharge.DiscountEditable}"
												style="{!quoteplan.contentstyle}" />
											<apex:outputText value="{!quotecharge.DisplayDiscount}"
												rendered="{!!quotecharge.DiscountEditable}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__EffectivePrice__c.Label}</apex:facet>
											<apex:inputField value="{!quotecharge.qcharge.zqu__EffectivePrice__c}"
												style="width:80%"
												rendered="{! (quotecharge.qcharge.Model__c != 'Discount-Percentage') && (quotecharge.qcharge.Model__c != 'Discount-Fixed Amount') && quotecharge.EffectivePriceEditable && quotecharge.EditMode}">
												<apex:actionSupport event="onchange"
													action="{!onOldEffectivePriceChange}"
													status="onchangeoldstatus" reRender="oldquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:outputText value="{!quotecharge.DisplayEffectivePrice}"
												rendered="{!!quotecharge.EditMode || !quotecharge.EffectivePriceEditable || (quotecharge.qcharge.Model__c == 'Discount-Percentage') || (quotecharge.qcharge.Model__c == 'Discount-Fixed Amount') }"
												style="{!quoteplan.contentstyle}" />
											<apex:outputText value="%"
												rendered="{!( quotecharge.qcharge.zqu__Model__c == 'Discount-Percentage' )}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Quantity__c.Label}</apex:facet>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Quantity__c}"
												style="width:80%"
												rendered="{!quotecharge.QuantityEditable && quotecharge.EditMode}">
												<apex:actionSupport event="onchange"
													action="{!onoldquantitychange}" status="onchangeoldstatus"
													reRender="oldquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:outputText value="{!quotecharge.DisplayQuantity}"
												rendered="{!!quotecharge.EditMode || !quotecharge.QuantityEditable }"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__UOM__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.DisplayUOM}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Period__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.DisplayRecurringPeriod}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListTotal__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.DisplayListTotal}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%" style="{!quotecharge.contentstyle}">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Total__c.Label}</apex:facet>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Total__c}"
												style="width:80%"
												rendered="{!quotecharge.TotalEditable && quotecharge.EditMode}">
												<apex:actionSupport event="onchange"
													action="{!onoldtotalchange}" status="onchangeoldstatus"
													reRender="oldquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:outputText value="{!quotecharge.DisplayTotal}"
												rendered="{!!quotecharge.EditMode || !quotecharge.TotalEditable }"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
									</apex:pageBlockTable>
									<apex:outputPanel id="oldquoteplanbuttons"
										rendered="{!editAction}">
										<apex:commandButton value="{!$Label.zqu__BUTTON_UPDATE}"
											style="position:relative;left:40%"
											action="{!updateoldquoteplan}"
											disabled="{!!quoteplan.isRenewEditable}"
											rendered="{!quoteplan.displayMode == 0 && !autoreplacing}"
											reRender="oldquoteplaninfo">
											<apex:param assignTo="{!focusquoteplanid}"
												name="focusquoteplanid" value="{!quoteplan.Id}" />
										</apex:commandButton>
										<apex:commandButton value="{!$Label.zqu__BUTTON_DELETE}"
											style="position:relative;left:40%"
											action="{!deleteOldQuotePlan}"
											rendered="{!quoteplan.displayMode == 0 && !autoreplacing}"
											reRender="oldquoteplaninfo,changelogs">
											<apex:param assignTo="{!focusquoteplanid}"
												name="focusquoteplanid" value="{!quoteplan.Id}" />
										</apex:commandButton>
										<apex:actionStatus id="onchangeoldstatus"
											onstart="disableinput(this);">
											<apex:facet name="start">
												<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_CALCULATING}"
													rendered="{!!autoreplacing}" disabled="true"
													style="position:relative;left:40%" />
											</apex:facet>
											<apex:facet name="stop">
												<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE}" status="changechargestatus"
													style="position:relative;left:40%"
													action="{!saveoldquoteplan}"
													rendered="{!quoteplan.displayMode == 1 && !autoreplacing}"
													reRender="oldquoteplaninfo,changelogs">
													<apex:param assignTo="{!focusquoteplanid}"
														name="focusquoteplanid" value="{!quoteplan.Id}" />
												</apex:commandButton>
											</apex:facet>
										</apex:actionStatus>
										<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}"
											style="position:relative;left:40%"
											action="{!canceloldquoteplan}"
											rendered="{!quoteplan.displayMode == 1 && !autoreplacing}"
											reRender="oldquoteplaninfo">
											<apex:param assignTo="{!focusquoteplanid}"
												name="focusquoteplanid" value="{!quoteplan.Id}" />
										</apex:commandButton>
										<apex:commandButton value="{!$Label.zqu__BUTTON_UNDELETE}"
											style="position:relative;left:45%"
											action="{!undeleteOldQuotePlan}"
											rendered="{!quoteplan.displayMode == 2 && !autoreplacing}"
											reRender="oldquoteplaninfo,changelogs">
											<apex:param assignTo="{!focusquoteplanid}"
												name="focusquoteplanid" value="{!quoteplan.Id}" />
										</apex:commandButton>
									</apex:outputPanel>
								</apex:actionRegion>
							</apex:panelBarItem>
						</apex:panelBar>
					</apex:repeat>
				</apex:outputPanel>
				<apex:outputPanel id="newquoteplanpanel">
					<apex:repeat var="quoteplan" value="{!newQuotePlans}"
						id="newQuotePlansrepeat">
						<apex:panelBar id="quoteplaninfo">
							<apex:panelBarItem label="{!quoteplan.productName} : {!quoteplan.Name}"
								expanded="true"
								headerStyle="{!quoteplan.background};{!quoteplan.contentstyle}"
								id="newquoteplanbar">
								<apex:actionRegion >
									<apex:pageBlockTable var="quotecharge"
										value="{!quoteplan.quotecharges}" rules="rows"
										cellpadding="4%" width="100%" id="newquoteplan">
										<apex:column width="15%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.Name.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.zcharge.Name}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ChargeType__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.zcharge.zqu__Type__c}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="10%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Model__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.zcharge.zqu__Model__c}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListPrice__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.DisplayListPrice}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Discount__c.Label}</apex:facet>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Discount__c}"
												style="width:70%"
												rendered="{!quotecharge.DiscountEditable && quotecharge.EditMode && !autoreplacing}">
												<apex:actionSupport event="onchange"
													action="{!onaddeddiscountchange}"
													status="changechargestatus1" reRender="newquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Discount__c}"
												style="width:70%"
												rendered="{!quotecharge.DiscountEditable && quotecharge.EditMode && autoreplacing}">
												<apex:actionSupport event="onchange"
													action="{!onaddeddiscountchange}"
													status="changechargesaveallstatus" reRender="newquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:outputText value="{!quotecharge.DisplayDiscount}"
												style="{!quoteplan.contentstyle}"
												rendered="{!quotecharge.DiscountEditable && !quotecharge.EditMode}"
												style="{!quoteplan.contentstyle}" />
											<apex:outputText value="%"
												rendered="{!quotecharge.DiscountEditable}" />
											<apex:outputText value="{!quotecharge.DisplayDiscount}"
												rendered="{!!quotecharge.DiscountEditable}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__EffectivePrice__c.Label}</apex:facet>
											<apex:inputField value="{!quotecharge.qcharge.zqu__EffectivePrice__c}"
												style="width:80%"
												rendered="{!quotecharge.EffectivePriceEditable && quotecharge.EditMode && !autoreplacing}">
												<apex:actionSupport event="onchange"
													action="{!onaddedepricechange}"
													status="changechargestatus1" reRender="newquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:inputField value="{!quotecharge.qcharge.zqu__EffectivePrice__c}"
												style="width:80%"
												rendered="{!quotecharge.EffectivePriceEditable && quotecharge.EditMode && autoreplacing}">
												<apex:actionSupport event="onchange"
													action="{!onaddedepricechange}"
													status="changechargesaveallstatus" reRender="newquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:outputText value="{!quotecharge.DisplayEffectivePrice}"
												rendered="{!!quotecharge.EditMode || !quotecharge.EffectivePriceEditable}"
												style="{!quoteplan.contentstyle}" />
											<apex:outputText value="%"
												rendered="{!( quotecharge.qcharge.zqu__Model__c == 'Discount-Percentage' )}" />
										</apex:column>
										<apex:column width="8%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Quantity__c.Label}</apex:facet>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Quantity__c}"
												style="width:80%"
												rendered="{!quotecharge.QuantityEditable && quotecharge.EditMode && !autoreplacing }">
												<apex:actionSupport event="onchange"
													action="{!onaddedquantitychange}"
													status="changechargestatus1" reRender="newquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Quantity__c}"
												style="width:80%"
												rendered="{!quotecharge.QuantityEditable && quotecharge.EditMode && autoreplacing}">
												<apex:actionSupport event="onchange"
													action="{!onaddedquantitychange}"
													status="changechargesaveallstatus" reRender="newquoteplan">
													<apex:param name="focusquoteplanid"
														assignTo="{!focusquoteplanid}" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:outputText value="{!quotecharge.DisplayQuantity}"
												rendered="{!!quotecharge.EditMode || !quotecharge.QuantityEditable }"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__UOM__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.DisplayUOM}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="8%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Period__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.DisplayRecurringPeriod}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="9%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListTotal__c.Label}</apex:facet>
											<apex:outputText value="{!quotecharge.DisplayListTotal}"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
										<apex:column width="10%">
											<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Total__c.Label}</apex:facet>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Total__c}"
												style="width:80%"
												rendered="{!quotecharge.TotalEditable && quotecharge.EditMode  && !autoreplacing}">
												<apex:actionSupport event="onchange"
													action="{!onaddedtotalchange}" status="changechargestatus1"
													reRender="newquoteplan">
													<apex:param assignTo="{!focusquoteplanid}"
														name="focusquoteplanid" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:inputField value="{!quotecharge.qcharge.zqu__Total__c}"
												style="width:80%"
												rendered="{!quotecharge.TotalEditable && quotecharge.EditMode && autoreplacing}">
												<apex:actionSupport event="onchange"
													action="{!onaddedtotalchange}"
													status="changechargesaveallstatus" reRender="newquoteplan">
													<apex:param assignTo="{!focusquoteplanid}"
														name="focusquoteplanid" value="{!quoteplan.Id}" />
													<apex:param name="changingchargeid"
														assignTo="{!changingchargeid}" value="{!quotecharge.Id}" />
												</apex:actionSupport>
											</apex:inputField>
											<apex:outputText value="{!quotecharge.DisplayTotal}"
												rendered="{!!quotecharge.EditMode || !quotecharge.TotalEditable }"
												style="{!quoteplan.contentstyle}" />
										</apex:column>
									</apex:pageBlockTable>
									<apex:outputPanel id="newquoteplanbuttons"
										rendered="{!editAction}">
										<apex:commandButton value="{!$Label.zqu__BUTTON_EDIT}"
											style="position:relative;left:40%"
											action="{!editnewquoteplan}"
											rendered="{!quoteplan.displayMode == 0 && !autoreplacing}"
											reRender="newquoteplan,newquoteplanbuttons">
											<apex:param assignTo="{!focusquoteplanid}"
												name="focusquoteplanid" value="{!quoteplan.Id}" />
										</apex:commandButton>
										<apex:commandButton value="{!$Label.zqu__BUTTON_DELETE}"
											style="position:relative;left:40%"
											onclick="if(!window.confirm('Are you sure you wish to remove this newly added product from the quote?')) return false;"
											action="{!deleteNewQuotePlan}"
											rendered="{!quoteplan.displayMode == 0 && editAction && !autoreplacing}"
											reRender="newquoteplanpanel,changelogs">
											<apex:param assignTo="{!focusquoteplanid}"
												name="focusquoteplanid" value="{!quoteplan.Id}" />
										</apex:commandButton>
										<apex:actionStatus id="changechargestatus1"
											onstart="disableinput(this);">
											<apex:facet name="start">
												<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_CALCULATING}"
													rendered="{!!autoreplacing}" disabled="true"
													style="position:relative;left:40%" />
											</apex:facet>
											<apex:facet name="stop">
												<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE}"
													status="changechargestatus1"
													style="position:relative;left:40%"
													action="{!savenewquoteplan}"
													rendered="{!quoteplan.displayMode == 1 && !autoreplacing}"
													reRender="newquoteplan,newquoteplanbuttons,changelogs">
													<apex:param assignTo="{!focusquoteplanid}"
														name="focusquoteplanid" value="{!quoteplan.Id}" />
												</apex:commandButton>
											</apex:facet>
										</apex:actionStatus>
										<apex:commandButton value="{!$Label.zqu__BUTTON_CANCEL}"
											style="position:relative;left:40%"
											action="{!cancelnewquoteplan}"
											rendered="{!quoteplan.displayMode == 1 && !autoreplacing}"
											reRender="newquoteplan,newquoteplanbuttons">
											<apex:param assignTo="{!focusquoteplanid}"
												name="focusquoteplanid" value="{!quoteplan.Id}" />
										</apex:commandButton>
									</apex:outputPanel>
								</apex:actionRegion>
							</apex:panelBarItem>
						</apex:panelBar>
					</apex:repeat>
				</apex:outputPanel>
				<apex:outputPanel id="addproductsbuttons"
					rendered="{!!isToHideDefaultProductSelector}">
					<apex:actionRegion >
						<apex:actionStatus id="addproductstatus">
							<apex:facet name="start">
								<apex:commandButton value="{!$Label.zqu__PRODUCT_GETTING_PRODUCT_CATALOG}"
									disabled="true" style="position:relative;left:40%" />
							</apex:facet>
							<apex:facet name="stop">
								<apex:commandButton value="{!$Label.zqu__PRODUCT_ADD_MORE_PRODUCTS}"
									style="position:relative;left:40%"
									oncomplete="fillproductpageBlockTable();"
									action="{!refreshproducts}" status="addproductstatus"
									rendered="{!editAction && !autoreplacing}"
									reRender="panProductSelector,panRatePlanSelector,panQuoteChargeSelector,addProductsButtons">
									<apex:param assignTo="{!resetProducts}" value="true" />
									<apex:param assignTo="{!productSearchString}"
										name="productSearchString" value="" />
								</apex:commandButton>
							</apex:facet>
						</apex:actionStatus>
						<apex:commandButton value="{!$Label.zqu__PRODUCT_CANCEL_ADD_PRODUCT}"
							style="position:relative;left:40%"
							rendered="{!showproduct && !autoreplacing}"
							action="{!canceladdcharges}"
							reRender="panProductSelector,panRatePlanSelector,panQuoteChargeSelector,addProductsButtons" />
						<apex:actionStatus rendered="{!autoreplacing}"
							id="changechargesaveallstatus" onstart="saveallstatus(true);"
							onstop="saveallstatus(false);">
							<apex:facet name="start">
								<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_CALCULATING}"
									rendered="{!autoreplacing}" disabled="true"
									style="position:relative;left:40%" />
							</apex:facet>
							<apex:facet name="stop">
								<apex:commandButton value="{!$Label.zqu__BUTTON_SAVE_ALL_CHANGES}"
									status="changechargesaveallstatus"
									style="position:relative;left:40%" action="{!saveall}"
									reRender="addproductsbuttons,subscriptionsection,changelogs"></apex:commandButton>
							</apex:facet>
						</apex:actionStatus>
					</apex:actionRegion>
				</apex:outputPanel>
			</apex:pageBlockSection>
			<apex:outputPanel id="panProductSelector">
				<apex:pageBlock title="{!SUBSTITUTE($Label.zqu__PRODUCT_SUMMARY_FILTERED_BY, '{0}', quote.zqu__Currency__c)}"
					rendered="{!showProduct}">
					<apex:pageMessage rendered="{!isProductSearchError}"
						summary="{!productSearchError}" severity="error" strength="1" />
					<apex:pageBlockButtons style="text-align:right" location="top">
						<apex:actionRegion >
							<apex:inputText id="itProductSearch"
								value="{!productSearchString}" />
						</apex:actionRegion>
						<apex:actionStatus id="stsProductSearch">
							<apex:facet name="start">
								<apex:commandButton value="{!$Label.zqu__ACTION_STATUS_SEARCHING}" disabled="true" />
							</apex:facet>
							<apex:facet name="stop">
								<apex:commandButton action="{!refreshProducts}" value="{!$Label.zqu__LOOKUP_BROWSE_SEARCH}"
									reRender="panProductSelector, panRatePlanSelector, panQuoteChargeSelector"
									status="stsProductSearch">
									<apex:param assignTo="{!resetProducts}" value="true" />
								</apex:commandButton>
							</apex:facet>
						</apex:actionStatus>
					</apex:pageBlockButtons>
					<apex:outputText rendered="{!products.size ==0}">{!$Label.zqu__PRODUCT_NO_PRODUCTS_FOUND}</apex:outputText>
					<apex:outputPanel rendered="{!products.size > 0}">
						<apex:pageBlockSection columns="1" showHeader="false">
							<apex:pageBlockTable id="tblProduct" title="products"
								var="product" value="{!products}" columns="4" cellpadding="3%"
								cellspacing="3%" style="width:100%" styleClass="list">
								<apex:column width="3%">
									<apex:facet name="header"></apex:facet>
									<apex:actionStatus id="stsGetRatePlan">
										<apex:facet name="start">
											<apex:outputPanel id="panProductSelectStart">
												<apex:image url="{!$Resource.zqu__ajaxLoading}" width="18"
													height="18" />
											</apex:outputPanel>
										</apex:facet>
										<apex:facet name="stop">
											<apex:outputPanel id="panProductSelectComplete">
												<apex:image id="imgRadioBtnChk"
													rendered="{!product.id == selProductId}"
													url="{!$Resource.zqu__radioBtnChk}" width="18" height="18" />
												<apex:image id="imgRadioBtnUnchk"
													rendered="{!NOT(product.id == selProductId)}"
													url="{!$Resource.zqu__radioBtnUnChk}" width="18" height="18"
													onclick="{onProductSelect(this);}" />
												<apex:actionSupport status="stsGetRatePlan" event="onclick"
													reRender="panProductSelector, panRatePlanSelector, panQuoteChargeSelector"
													action="{!refreshRateplans}">
													<apex:param assignTo="{!selProductId}" name="selProduct"
														value="{!product.id}" />
													<apex:param assignTo="{!resetRatePlans}"
														name="resetRatePlans" value="true" />
													<apex:param assignTo="{!ratePlanSearchString}"
														name="ratePlanSearchString" value="" />
												</apex:actionSupport>
											</apex:outputPanel>
										</apex:facet>
									</apex:actionStatus>
								</apex:column>
								<apex:column width="30%">
									<apex:facet name="header">{!$ObjectType.zqu__ZProduct__c.fields.Name.Label}</apex:facet>
									<apex:outputText value="{!product.Name}" />
								</apex:column>
								<apex:column width="15%">
									<apex:facet name="header">{!$ObjectType.zqu__ZProduct__c.fields.zqu__SKU__c.Label}</apex:facet>
									<apex:outputText value="{!product.zqu__SKU__c}" />
								</apex:column>
								<apex:column width="57%">
									<apex:facet name="header">{!$ObjectType.zqu__ZProduct__c.fields.zqu__Description__c.Label}</apex:facet>
									<apex:outputText value="{!product.zqu__Description__c}" />
								</apex:column>
							</apex:pageBlockTable>
						</apex:pageBlockSection>
					</apex:outputPanel>
					<table width="100%" style="text-align: right">
						<tbody>
							<tr>
								<td>
									<table style="text-align: left">
										<tbody>
											<tr>
												<td>
													<div>
														<apex:outputLabel rendered="{!products.size !=0}"
															id="lblProductSectionInfo" value="{!productSectionInfo}" />
													</div>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
								<td colspan="6">
									<div>
										<span> <apex:commandLink action="{!prevProductPage}"
												rendered="{!AND(productHasPrevious, NOT(productNavFlagDisabled))}"
												reRender="panProductSelector,panRatePlanSelector,panQuoteChargeSelector"
												onclick="{foldRatePlan();foldQuoteCharge();}">
												<apex:image value="{!$Resource.zqu__back_enabled}" />
												</apex:commandlink>
												<apex:image value="{!$Resource.zqu__back_disabled}"
													rendered="{!OR(NOT(productHasPrevious), productNavFlagDisabled)}" /></span>
										<span> <apex:commandLink action="{!nextProductPage}"
												rendered="{!AND(productHasNext, NOT(productNavFlagDisabled))}"
												reRender="panProductSelector,panRatePlanSelector,panQuoteChargeSelector"
												onclick="{foldRatePlan();foldQuoteCharge();}">
												<apex:image value="{!$Resource.zqu__forward_enabled}" />
												</apex:commandlink>
												<apex:image value="{!$Resource.zqu__forward_disabled}"
													rendered="{!OR(NOT(productHasNext), productNavFlagDisabled)}" /></span>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</apex:pageBlock>
			</apex:outputPanel>
			<apex:outputPanel id="panRatePlanSelector">
				<apex:pageBlock title="{!$Label.zqu__RATE_PLAN_SUMMARY}" rendered="{!showRatePlan}">
					<apex:pageMessage rendered="{!isRatePlanSearchError}"
						summary="{!ratePlanSearchError}" severity="error" strength="1" />
					<apex:pageBlockButtons style="text-align:right" location="top">
						<apex:actionRegion >
							<apex:inputText id="ratePlanSearch" styleclass="tableitem"
								style="left:80%" value="{!ratePlanSearchString}" />
						</apex:actionRegion>
						<apex:actionStatus id="ratePlanSearchStatus">
							<apex:facet name="start">
								<apex:commandButton styleclass="tableitem" style="left:60%"
									value="{!$Label.zqu__ACTION_STATUS_SEARCHING}" disabled="true"></apex:commandButton>
							</apex:facet>
							<apex:facet name="stop">
								<apex:commandButton action="{!refreshRateplans}"
									styleclass="tableitem" style="left:60%" value="Search"
									reRender="panRatePlanSelector, panQuoteChargeSelector"
									status="ratePlanSearchStatus">
									<apex:param assignTo="{!resetRatePlans}" value="true" />
								</apex:commandButton>
							</apex:facet>
						</apex:actionStatus>
					</apex:pageBlockButtons>
					<apex:outputText rendered="{!rateplans.size ==0}">{!$Label.zqu__RATE_PLAN_NO_RATE_PLAN_FOUND}</apex:outputText>
					<apex:outputPanel rendered="{!rateplans.size > 0}">
						<apex:pageBlockSection columns="1" showHeader="false">
							<apex:pageBlockTable id="tblRatePlan" title="ratePlans"
								var="ratePlan" value="{!ratePlans}" columns="3" cellpadding="3%"
								cellspacing="3%" style="width:100%" styleClass="list">
								<apex:column width="3%">
									<apex:facet name="header"></apex:facet>
									<apex:actionStatus id="stsGetQuoteCharge">
										<apex:facet name="start">
											<apex:outputPanel id="ratePlanSelectStart">
												<apex:image url="{!$Resource.zqu__ajaxLoading}" width="18"
													height="18" />
											</apex:outputPanel>
										</apex:facet>
										<apex:facet name="stop">
											<apex:outputPanel id="ratePlanSelectComplete">
												<apex:image id="imgRadioBtnChk"
													rendered="{!ratePlan.id == selRatePlanId}"
													url="{!$Resource.zqu__radioBtnChk}" width="18" height="18" />
												<apex:image id="imgRadioBtnUnchk"
													rendered="{!NOT(ratePlan.id == selRatePlanId)}"
													url="{!$Resource.zqu__radioBtnUnChk}" width="18" height="18"
													onclick="{onRatePlanSelect(this);}" />
												<apex:actionSupport status="stsGetQuoteCharge"
													event="onclick"
													reRender="panRatePlanSelector, panQuoteChargeSelector"
													action="{!refreshQuoteCharges}">
													<apex:param assignTo="{!selRatePlanId}" name="selRatePlan"
														value="{!ratePlan.id}" />
													<apex:param assignTo="{!resetquoteCharges}"
														name="resetquoteCharges" value="true" />
												</apex:actionSupport>
											</apex:outputPanel>
										</apex:facet>
									</apex:actionStatus>
								</apex:column>
								<apex:column width="30%">
									<apex:facet name="header">{!$ObjectType.zqu__ProductRatePlan__c.fields.Name.Label}</apex:facet>
									<apex:outputLabel value="{!ratePlan.Name}" />
								</apex:column>
								<apex:column width="67%">
									<apex:facet name="header">{!$ObjectType.zqu__ProductRatePlan__c.fields.zqu__Description__c.Label}</apex:facet>
									<apex:outputText value="{!ratePlan.zqu__Description__c}" />
								</apex:column>
							</apex:pageBlockTable>
						</apex:pageBlockSection>
					</apex:outputPanel>
					<table width="100%" style="text-align: right">
						<tbody>
							<tr>
								<td>
									<table style="text-align: left">
										<tbody>
											<tr>
												<td>
													<div>
														<apex:outputLabel rendered="{!rateplans.size !=0}"
															value="{!ratePlanSectionInfo}"></apex:outputLabel>
													</div>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
								<td colspan="6">
									<div>
										<span> <apex:commandLink action="{!prevRatePlanPage}"
												rendered="{!AND(ratePlanHasPrevious, NOT(ratePlanNavFlagDisabled))}"
												reRender="panRatePlanSelector,panQuoteChargeSelector"
												onclick="foldQuoteCharge()">
												<apex:image value="{!$Resource.zqu__back_enabled}" />
												</apex:commandlink>
												<apex:image value="{!$Resource.zqu__back_disabled}"
													rendered="{!OR(NOT(ratePlanHasPrevious), ratePlanNavFlagDisabled)}" /></span>
										<span> <apex:commandLink action="{!nextRatePlanPage}"
												rendered="{!AND(ratePlanHasNext, NOT(ratePlanNavFlagDisabled))}"
												reRender="panRatePlanSelector,panQuoteChargeSelector"
												onclick="foldQuoteCharge()">
												<apex:image value="{!$Resource.zqu__forward_enabled}" />
												</apex:commandlink>
												<apex:image value="{!$Resource.zqu__forward_disabled}"
													rendered="{!OR(NOT(ratePlanHasNext), ratePlanNavFlagDisabled)}" /></span>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</apex:pageBlock>
			</apex:outputPanel>
			<apex:outputPanel id="panQuoteChargeSelector">
				<apex:pageBlock title="{!$Label.zqu__RATE_PLAN_CHARGE_SUMMARY}"
					rendered="{!showquoteCharge}">
					<apex:pageMessage rendered="{!isQuoteChargeError}"
						summary="{!quoteChargeError}" severity="error" strength="1" />
					<apex:pageBlockButtons location="bottom">
						<table width="100%" style="text-align: left">
							<tbody>
								<tr>
									<td><span> <apex:commandButton id="btnAdd"
												value="{!$Label.zqu__BUTTON_ADD}"
												onclick="disableInput4QuoteCharge(); disableAdd4QuoteCharge('Saving');"
												action="{!addcharges}"
												reRender="subscriptionsection, panProductSelector, panRatePlanSelector, panQuoteChargeSelector, changelogs" />
									</span> <span> <apex:commandButton id="btnCancel"
												value="{!$Label.zqu__BUTTON_CANCEL}" action="{!cancelAddCharges}"
												reRender="addProductsButtons, panProductSelector, panRatePlanSelector, panQuoteChargeSelector" />
									</span></td>
									<td colspan="2"></td>
								</tr>
							</tbody>
						</table>
						<apex:actionStatus id="changeAddingChargeStatus"
							onstart="disableInput4QuoteCharge();disableAdd4QuoteCharge('Calculating');"></apex:actionStatus>
					</apex:pageBlockButtons>
					<apex:pageBlockTable var="quoteCharge" value="{!quoteCharges}"
						rules="rows" columns="11" cellpadding="3%" id="tblAddCharges"
						style="width:100%" styleClass="list" cellspacing="3%">
						<apex:column width="15%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.Name.Label}</apex:facet>
							<apex:outputText value="{!quoteCharge.qcharge.Name}" />
						</apex:column>
						<apex:column width="8%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ChargeType__c.Label}</apex:facet>
							<apex:outputText value="{!quoteCharge.qcharge.zqu__ChargeType__c}" />
						</apex:column>
						<apex:column width="10%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Model__c.Label}</apex:facet>
							<apex:outputText value="{!quoteCharge.qcharge.zqu__Model__c}" />
						</apex:column>
						<apex:column width="8%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListPrice__c.Label}</apex:facet>
							<apex:outputText value="{!quoteCharge.DisplayListPrice}" />
						</apex:column>
						<apex:column width="8%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Discount__c.Label}</apex:facet>
							<apex:inputField value="{!quoteCharge.qcharge.zqu__Discount__c}"
								style="width:70%;font-weight:bold"
								rendered="{!quoteCharge.DiscountEditable}">
								<apex:actionSupport action="{!onDiscountChange}"
									event="onchange" status="changeAddingChargeStatus"
									reRender="panQuoteChargeSelector">
									<apex:param name="changingchargeid"
										assignTo="{!changingchargeid}" value="{!quoteCharge.id}" />
								</apex:actionSupport>
							</apex:inputField>
							<apex:outputText value="{!quoteCharge.DisplayDiscount}"
								rendered="{!!quoteCharge.DiscountEditable}" />
							<apex:outputText value="%"
								rendered="{!quoteCharge.DiscountEditable}" />
						</apex:column>
						<apex:column width="8%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__EffectivePrice__c.Label}</apex:facet>
							<apex:inputField value="{!quoteCharge.qcharge.zqu__EffectivePrice__c}"
								style="width:80%;font-weight:bold"
								rendered="{!quoteCharge.EffectivePriceEditable}">
								<apex:actionSupport action="{!onEffectivePriceChange}"
									event="onchange" status="changeAddingChargeStatus"
									reRender="panQuoteChargeSelector">
									<apex:param name="changingchargeid"
										assignTo="{!changingchargeid}" value="{!quoteCharge.id}" />
								</apex:actionSupport>
							</apex:inputField>
							<apex:outputText value="{!quoteCharge.DisplayEffectivePrice}"
								rendered="{!!quoteCharge.EffectivePriceEditable }" />
							<apex:outputText value="%"
								rendered="{!( quoteCharge.qcharge.zqu__Model__c == 'Discount-Percentage' )}" />
						</apex:column>
						<apex:column width="8%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Quantity__c.Label}</apex:facet>
							<apex:inputField value="{!quoteCharge.qcharge.zqu__Quantity__c}"
								style="width:80%;font-weight:bold"
								rendered="{!quoteCharge.QuantityEditable}">
								<apex:actionSupport action="{!onQuantityChange}"
									event="onchange" status="changeAddingChargeStatus"
									reRender="panQuoteChargeSelector">
									<apex:param name="changingchargeid"
										assignTo="{!changingchargeid}" value="{!quoteCharge.id}" />
								</apex:actionSupport>
							</apex:inputField>
							<apex:outputText value="{!quoteCharge.DisplayQuantity}"
								rendered="{!!quoteCharge.QuantityEditable }" />
						</apex:column>
						<apex:column width="8%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__UOM__c.Label}</apex:facet>
							<apex:outputText value="{!quoteCharge.DisplayUOM}" />
						</apex:column>
						<apex:column width="8%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Period__c.Label}</apex:facet>
							<apex:outputText value="{!quoteCharge.DisplayRecurringPeriod}" />
						</apex:column>
						<apex:column width="9%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__ListTotal__c.Label}</apex:facet>
							<apex:outputText value="{!quoteCharge.DisplayListTotal}" />
						</apex:column>
						<apex:column width="10%">
							<apex:facet name="header">{!$ObjectType.zqu__QuoteCharge__c.fields.zqu__Total__c.Label}</apex:facet>
							<apex:inputField value="{!quoteCharge.qcharge.zqu__Total__c}"
								style="width:80%;font-weight:bold"
								rendered="{!quoteCharge.TotalEditable}">
								<apex:actionSupport action="{!onTotalChange}" event="onchange"
									status="changeAddingChargeStatus"
									reRender="panQuoteChargeSelector">
									<apex:param name="changingchargeid"
										assignTo="{!changingchargeid}" value="{!quoteCharge.id}" />
								</apex:actionSupport>
							</apex:inputField>
							<apex:outputText value="{!quoteCharge.DisplayTotal}"
								rendered="{!!quoteCharge.TotalEditable }" />
							<apex:outputText />
						</apex:column>
					</apex:pageBlockTable>
				</apex:pageBlock>
			</apex:outputPanel>
			<apex:pageBlockSection title="{!$Label.zqu__CHANGES_VS_ORIGINAL}" id="changelogs"
				columns="1">
				<apex:outputText value="{!$Label.zqu__CHANGES_NO_CHANGE_YET}"
					rendered="{!changeLogDetails.size == 0}" />
				<apex:pageBlockTable var="logdetail" value="{!changeLogDetails}"
					rules="rows" width="100%" columns="3" cellpadding="3%"
					rendered="{!changeLogDetails.size >0}">
					<apex:column width="90%">
						<apex:facet name="header">{!$Label.zqu__COLUMN_DESCRIPTION}</apex:facet>
						<apex:outputText value="{!logdetail.description}"
							style="font-weight:bold" />
					</apex:column>
					<apex:column width="10%" rendered="{!editAction}">
						<apex:facet name="header">{!$Label.zqu__COLUMN_ACTIONS}</apex:facet>
						<apex:actionRegion >
							<apex:commandButton value="Undo" action="{!onClickUndo}"
								rendered="{!logdetail.logtype != 1 && logdetail.logtype != 3 && logdetail.logtype != 5 && !autoreplacing}"
								reRender="changelogs,oldquoteplanpanel">
								<apex:param name="undotype" assignTo="{!undotype}"
									value="{!logdetail.logtype}" />
								<apex:param name="focusquoteplanid"
									assignTo="{!focusquoteplanid}" value="{!logdetail.quoteplanid}" />
							</apex:commandButton>
							<apex:commandButton value="{!$Label.zqu__BUTTON_UNDO}" action="{!onClickUndo}"
								onclick="if(!window.confirm('{!$Label.zqu__PRODUCT_REMOVE_NEWLY_ADDED_PRODUCT}')) return false;"
								rendered="{!logdetail.logtype == 1 && !autoreplacing}"
								reRender="changelogs,newquoteplanpanel">
								<apex:param name="undotype" assignTo="{!undotype}"
									value="{!logdetail.logtype}" />
								<apex:param name="focusquoteplanid"
									assignTo="{!focusquoteplanid}" value="{!logdetail.quoteplanid}" />
							</apex:commandButton>
						</apex:actionRegion>
					</apex:column>
				</apex:pageBlockTable>
			</apex:pageBlockSection>
		</apex:pageBlock>
	</apex:form>
</apex:page>